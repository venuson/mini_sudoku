System.register("chunks:///_virtual/AccountManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts","./CloudService.ts","./UserData.ts"],(function(e){var n,t,s,o,c,r,i,u,a,l,g,d,h,_;return{setters:[function(e){n=e.inheritsLoose,t=e.createClass,s=e.asyncToGenerator},function(e){o=e.cclegacy,c=e._decorator,r=e.warn,i=e.director,u=e.error,a=e.Component,l=e.sys},function(e){g=e.Constants},function(e){d=e.CloudService},function(e){h=e.generateLevelRecordKey,_=e.createEmptyUserAccount}],execute:function(){var A,f;o._RF.push({},"b6cadotBjxHkqpf6uEpsycs","AccountManager",void 0);var v=c.ccclass;c.property,e("AccountManager",v("AccountManager")(((f=function(e){function o(){for(var n,t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];return(n=e.call.apply(e,[this].concat(s))||this)._isInitialized=!1,n._isLoggingIn=!1,n._isLoggedIn=!1,n._userId=null,n._userAccount=null,n._isNewUser=!1,n}n(o,e);var c=o.prototype;return c.onLoad=function(){if(console.log("[AccountManager] onLoad"),o._instance&&o._instance!==this)return r("[AccountManager] 另一个实例已存在，销毁当前实例。"),void this.destroy();o._instance=this,this.node.parent&&(i.addPersistRootNode(this.node),console.log("[AccountManager] 节点已设为持久化。")),this._isInitialized=!0,console.log("[AccountManager] 初始化完成。")},c.onDestroy=function(){console.log("[AccountManager] onDestroy"),o._instance===this&&(o._instance=null),this._isLoggedIn=!1,this._userId=null,this._userAccount=null},c.login=function(){var e=s((function*(e){if(void 0===e&&(e=!1),!this._isInitialized)return r("[AccountManager] login 在初始化之前被调用。"),!1;if(this._isLoggingIn)return r("[AccountManager] 正在登录中，请稍候..."),!1;if(this._isLoggedIn&&!e)return console.log("[AccountManager] 用户已登录。"),!0;if(!l.platform.toLowerCase().includes("wechat"))return r("[AccountManager] 非微信平台，跳过登录流程。"),this._isLoggedIn=!1,this._userId="guest_user",this._userAccount=_(this._userId),i.emit(g.EventName.LOGIN_SUCCESS,this._userId),!0;console.log("[AccountManager] 开始登录流程..."),this._isLoggingIn=!0,this._isLoggedIn=!1;try{var n=yield this.wxLogin();if(!n||!n.code)throw new Error("wx.login 调用失败或未返回 code。");var t=n.code;console.log("[AccountManager] wx.login 成功, code:",t);var s=yield d.authenticateUser(t);return this._userId=s.userId,this._isNewUser=s.isNewUser,console.log("[AccountManager] 云端认证成功, userId: "+this._userId+", isNewUser: "+this._isNewUser),console.log("[AccountManager] 获取用户账户信息..."),this._userAccount=yield this.fetchUserAccountData(),this._isLoggedIn=!0,console.log("[AccountManager] 登录成功！"),i.emit(g.EventName.LOGIN_SUCCESS,this._userId),!0}catch(e){return u("[AccountManager] 登录流程失败:",e),this._isLoggedIn=!1,this._userId=null,this._userAccount=null,i.emit(g.EventName.LOGIN_FAIL),!1}finally{this._isLoggingIn=!1}}));return function(n){return e.apply(this,arguments)}}(),c.isLoggedIn=function(){return this._isLoggedIn},c.getUserId=function(){return this._userId},c.getUserAccount=function(){return this._userAccount},c.getLevelRecord=function(e,n){if(!this._userAccount||!this._userAccount.levelRecords)return null;var t=h(e,n);return this._userAccount.levelRecords[t]||null},c.getAllLevelRecords=function(){return this._userAccount&&this._userAccount.levelRecords?Object.values(this._userAccount.levelRecords):[]},c.saveLevelResult=function(){var e=s((function*(e,n,t){if(!this._isLoggedIn||!this._userId)return r("[AccountManager] 用户未登录，无法保存关卡结果。"),!1;if(!this._isInitialized)return r("[AccountManager] saveLevelResult 在初始化之前被调用。"),!1;console.log("[AccountManager] 保存关卡结果: "+e+"-"+n+", time="+t+"s");var s=Date.now();try{if(yield d.updateUserRecord(this._userId,e,n,t,s),this._userAccount){var o=h(e,n),c=this._userAccount.levelRecords[o];c?t<c.bestTimeSeconds&&(console.log("[AccountManager] 新的最佳时间记录: "+t+"s (原: "+c.bestTimeSeconds+"s)"),c.bestTimeSeconds=t):(console.log("[AccountManager] 首次完成关卡: "+e+"-"+n),this._userAccount.levelRecords[o]={difficulty:e,levelIndex:n,bestTimeSeconds:t,firstCompletionTimestamp:s},this._userAccount.totalLevelsCompleted=(this._userAccount.totalLevelsCompleted||0)+1,!0),i.emit(g.EventName.USER_RECORDS_UPDATED,this.getAllLevelRecords())}else r("[AccountManager] 用户账户本地缓存不存在，无法立即更新。将在下次登录时同步。");return!0}catch(e){return u("[AccountManager] 保存关卡结果失败:",e),!1}}));return function(n,t,s){return e.apply(this,arguments)}}(),c.wxLogin=function(){return new Promise((function(e){wx.login({success:function(n){e(n)},fail:function(n){u("[AccountManager] wx.login fail:",n),e(null)}})}))},c.fetchUserAccountData=function(){var e=s((function*(){if(!this._userId)return u("[AccountManager] 无法获取用户账户数据：userId 为空。"),_("unknown_user");try{var e=yield d.fetchUserRecords(this._userId),n=_(this._userId);return n.levelRecords=e,n.totalLevelsCompleted=Object.keys(e).length,console.log("[AccountManager] 从云端获取用户账户数据成功。"),n}catch(e){return u("[AccountManager] 获取用户账户数据失败:",e),_(this._userId)}}));return function(){return e.apply(this,arguments)}}(),c.tryFetchWxUserInfo=function(){var e=s((function*(){var e=this;return this._isLoggedIn&&l.platform.toLowerCase().includes("wechat")?this._userAccount&&this._userAccount.nickname&&this._userAccount.avatarUrl?(console.log("[AccountManager] 用户昵称和头像已存在，跳过获取。"),!0):(console.log("[AccountManager] 尝试获取微信用户信息 (需要用户授权)..."),new Promise((function(n){wx.getUserProfile({desc:"用于完善用户信息及排行榜展示",success:function(t){console.log("[AccountManager] wx.getUserProfile 成功:",t.userInfo);var s=t.userInfo,o=s.nickName,c=s.avatarUrl;e._userAccount&&(e._userAccount.nickname=o,e._userAccount.avatarUrl=c),n(!0)},fail:function(e){u("[AccountManager] wx.getUserProfile 失败:",e),n(!1)}})}))):(r("[AccountManager] 用户未登录或非微信平台，无法获取用户信息。"),!1)}));return function(){return e.apply(this,arguments)}}(),t(o,null,[{key:"instance",get:function(){return this._instance||u("[AccountManager] 实例在初始化之前或节点不存在时被请求。"),this._instance}}]),o}(a))._instance=null,A=f))||A);o._RF.pop()}}}));

System.register("chunks:///_virtual/ActionRecord.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"deb43mD841B5pvva4QbSLHJ","ActionRecord",void 0);i("ActionRecord",(function(i,t,e,o,c){this.type=void 0,this.row=void 0,this.col=void 0,this.previousValue=void 0,this.newValue=void 0,this.type=i,this.row=t,this.col=e,this.previousValue=o,this.newValue=c}));t._RF.pop()}}}));

System.register("chunks:///_virtual/AdManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts"],(function(n){var t,e,i,a,r,s,o,d,l,c,h,g,A,u;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,a=n.assertThisInitialized,r=n.createClass},function(n){s=n.cclegacy,o=n._decorator,d=n.warn,l=n.director,c=n.sys,h=n.isValid,g=n.error,A=n.Component},function(n){u=n.Constants}],execute:function(){var _,I,f,M,B,y,p,b;s._RF.push({},"f43b1WTC95O9LpK7Ne8TX0s","AdManager",void 0);var w=o.ccclass,L=o.property;n("AdManager",(_=w("AdManager"),I=L({type:String,tooltip:"暂停时显示的 Banner 广告单元 ID"}),f=L({type:String,tooltip:"暂停时显示的插屏广告单元 ID (可选)"}),_(((b=function(n){function t(){for(var t,e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return t=n.call.apply(n,[this].concat(r))||this,i(t,"pauseBannerAdUnitId",y,a(t)),i(t,"pauseInterstitialAdUnitId",p,a(t)),t._isInitialized=!1,t._bannerAd=null,t._interstitialAd=null,t._isBannerLoadingOrVisible=!1,t._isInterstitialLoading=!1,t._isInterstitialReady=!1,t}e(t,n);var s=t.prototype;return s.onLoad=function(){if(console.log("[AdManager] onLoad"),t._instance&&t._instance!==this)return d("[AdManager] 另一个实例已存在，销毁当前实例。"),void this.destroy();t._instance=this,this.node.parent&&(l.addPersistRootNode(this.node),console.log("[AdManager] 节点已设为持久化。")),l.on(u.EventName.SHOW_AD,this.showPauseAd,this),l.on(u.EventName.HIDE_AD,this.hidePauseAd,this),this._isInitialized=!0,console.log("[AdManager] 初始化完成。")},s.onDestroy=function(){console.log("[AdManager] onDestroy"),t._instance===this&&(t._instance=null),this.destroyBannerAd(),this.destroyInterstitialAd(),l.targetOff(this)},s.createBannerAd=function(n,t){var e=this;if(!c.platform.toLowerCase().includes("wechat"))return d("[AdManager] 非微信平台，无法创建 Banner 广告。"),null;if(!n||n.startsWith("YOUR_"))return d("[AdManager] 无效的 Banner 广告单元 ID:",n),null;this.destroyBannerAd(),console.log("[AdManager] 创建 Banner 广告实例, Unit ID:",n);try{var i=wx.getSystemInfoSync().screenWidth,a=wx.getSystemInfoSync().screenHeight,r=Math.min(i,320),s=a,A=(i-r)/2;if(h(t)){var u=t.getComponent(o.UITransform);if(u){var _=u.convertToWorldSpaceAR(new Vec3(0,0,0)),I=u.height*l.getScene().getScale().y,f=u.width*l.getScene().getScale().x,M=a-_.y;s=M,A=_.x,r=f,console.log("[AdManager] 定位 Banner 到容器下方: screenY="+M+", nodeHeight="+I)}}var B=wx.createBannerAd({adUnitId:n,adIntervals:30,style:{left:A,top:s,width:r}});return B?(B.onLoad((function(){console.log("[AdManager] Banner 广告加载成功。"),e._isBannerLoadingOrVisible=!0})),B.onError((function(n){g("[AdManager] Banner 广告加载或显示失败:",n),e._isBannerLoadingOrVisible=!1})),B.onResize((function(n){if(console.log("[AdManager] Banner 广告尺寸调整: width="+n.width+", height="+n.height),e._bannerAd){var t=a-n.height;e._bannerAd.style.top=t,console.log("[AdManager] Banner 广告位置调整到屏幕底部: top="+t)}})),this._bannerAd=B,B):(g("[AdManager] wx.createBannerAd 返回 null。"),null)}catch(n){return g("[AdManager] 创建 Banner 广告时发生异常:",n),null}},s.destroyBannerAd=function(){this._bannerAd&&(console.log("[AdManager] 销毁 Banner 广告实例。"),this._bannerAd.destroy().catch((function(n){return d("[AdManager] 销毁 Banner 广告失败:",n)})),this._bannerAd=null,this._isBannerLoadingOrVisible=!1)},s.createInterstitialAd=function(n){var t=this;if(!c.platform.toLowerCase().includes("wechat"))return d("[AdManager] 非微信平台，无法创建插屏广告。"),null;if(!n||n.startsWith("YOUR_"))return d("[AdManager] 无效的插屏广告单元 ID:",n),null;this.destroyInterstitialAd(),console.log("[AdManager] 创建插屏广告实例, Unit ID:",n);try{var e=wx.createInterstitialAd({adUnitId:n});return e?(e.onLoad((function(){console.log("[AdManager] 插屏广告加载成功。"),t._isInterstitialReady=!0,t._isInterstitialLoading=!1})),e.onError((function(n){g("[AdManager] 插屏广告加载或显示失败:",n),t._isInterstitialReady=!1,t._isInterstitialLoading=!1})),e.onClose((function(){console.log("[AdManager] 插屏广告已关闭。"),t._isInterstitialReady=!1})),this._interstitialAd=e,e):(g("[AdManager] wx.createInterstitialAd 返回 null。"),null)}catch(n){return g("[AdManager] 创建插屏广告时发生异常:",n),null}},s.destroyInterstitialAd=function(){this._interstitialAd&&(console.log("[AdManager] 销毁插屏广告实例。"),this._interstitialAd.destroy().catch((function(n){return d("[AdManager] 销毁插屏广告失败:",n)})),this._interstitialAd=null,this._isInterstitialReady=!1,this._isInterstitialLoading=!1)},s.showPauseAd=function(n){if(this._isInitialized){if(console.log("[AdManager] 请求显示暂停广告..."),this.pauseInterstitialAdUnitId&&!this.pauseInterstitialAdUnitId.startsWith("YOUR_"))return this._isInterstitialReady?(console.log("[AdManager] 插屏广告已就绪，尝试显示..."),void this.showInterstitialAdInstance()):this._isInterstitialLoading?void console.log("[AdManager] 插屏广告正在加载中..."):(console.log("[AdManager] 插屏广告未就绪，开始加载..."),void this.loadInterstitialAd());console.log("[AdManager] 未配置插屏广告或 ID 无效，尝试显示 Banner。"),this.showBannerAd(n)}else d("[AdManager] showPauseAd 在初始化之前被调用。")},s.hidePauseAd=function(){this._isInitialized?(console.log("[AdManager] 请求隐藏暂停广告..."),this.hideBannerAd()):d("[AdManager] hidePauseAd 在初始化之前被调用。")},s.showBannerAd=function(n){var t=this;if(this._isBannerLoadingOrVisible)return console.log("[AdManager] Banner 广告已在加载或显示中。"),void(this._bannerAd&&!this._isBannerLoadingOrVisible&&this._bannerAd.show().catch((function(n){return g("[AdManager] 重新显示 Banner 广告失败:",n)})));this._bannerAd||this.createBannerAd(this.pauseBannerAdUnitId,n),this._bannerAd?(console.log("[AdManager] 显示 Banner 广告..."),this._isBannerLoadingOrVisible=!0,this._bannerAd.show().then((function(){console.log("[AdManager] Banner 广告显示成功 (show promise resolved).")})).catch((function(n){g("[AdManager] 显示 Banner 广告失败 (show promise rejected):",n),t._isBannerLoadingOrVisible=!1}))):d("[AdManager] Banner 广告实例无效，无法显示。")},s.hideBannerAd=function(){var n=this;this._bannerAd&&this._isBannerLoadingOrVisible&&(console.log("[AdManager] 隐藏 Banner 广告..."),this._bannerAd.hide().then((function(){console.log("[AdManager] Banner 广告隐藏成功。"),n._isBannerLoadingOrVisible=!1})).catch((function(t){d("[AdManager] 隐藏 Banner 广告失败:",t),n._isBannerLoadingOrVisible=!1})))},s.loadInterstitialAd=function(){var n=this;this._isInterstitialLoading||this._isInterstitialReady?console.log("[AdManager] 插屏广告已加载或正在加载中。"):(this._interstitialAd||this.createInterstitialAd(this.pauseInterstitialAdUnitId),this._interstitialAd?(console.log("[AdManager] 开始加载插屏广告..."),this._isInterstitialLoading=!0,this._interstitialAd.load().catch((function(t){g("[AdManager] 调用插屏广告 load 方法失败:",t),n._isInterstitialLoading=!1}))):d("[AdManager] 插屏广告实例无效，无法加载。"))},s.showInterstitialAdInstance=function(){var n=this;this._interstitialAd&&this._isInterstitialReady?(console.log("[AdManager] 显示插屏广告..."),this._interstitialAd.show().then((function(){console.log("[AdManager] 插屏广告显示成功。")})).catch((function(t){g("[AdManager] 显示插屏广告失败:",t),n._isInterstitialReady=!1}))):(d("[AdManager] 插屏广告未就绪或实例无效，无法显示。"),this._isInterstitialReady||this._isInterstitialLoading||this.loadInterstitialAd())},r(t,null,[{key:"instance",get:function(){return this._instance||g("[AdManager] 实例在初始化之前或节点不存在时被请求。"),this._instance}}]),t}(A))._instance=null,y=t((B=b).prototype,"pauseBannerAdUnitId",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"YOUR_BANNER_AD_UNIT_ID"}}),p=t(B.prototype,"pauseInterstitialAdUnitId",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"YOUR_INTERSTITIAL_AD_UNIT_ID"}}),M=B))||M));s._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts"],(function(i){var e,o,n,t,a,s,r,l,u,d,c,g,h,p,f,m;return{setters:[function(i){e=i.applyDecoratedDescriptor,o=i.inheritsLoose,n=i.initializerDefineProperty,t=i.assertThisInitialized,a=i.createClass,s=i.asyncToGenerator},function(i){r=i.cclegacy,l=i._decorator,u=i.AudioSource,d=i.warn,c=i.director,g=i.error,h=i.Component,p=i.resources,f=i.AudioClip},function(i){m=i.Constants}],execute:function(){var b,S,M,A,_,y,B,x;r._RF.push({},"284b1f7WbdBRLExYXbrxaG9","AudioManager",void 0);var z=l.ccclass,E=l.property;i("AudioManager",(b=z("AudioManager"),S=E({type:u,tooltip:"AudioSource component for background music (looping)"}),M=E({type:u,tooltip:"AudioSource component for sound effects (non-looping)"}),b(((x=function(i){function e(){for(var e,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return e=i.call.apply(i,[this].concat(a))||this,n(e,"bgmSource",y,t(e)),n(e,"sfxSource",B,t(e)),e._audioClips=new Map,e._isInitialized=!1,e._isLoading=!1,e._isBgmEnabled=!0,e._isSfxEnabled=!0,e._currentBgmName=null,e}o(e,i);var r=e.prototype;return r.onLoad=function(){var i=this;if(console.log("[AudioManager] onLoad"),e._instance&&e._instance!==this)return d("[AudioManager] Another instance already exists. Destroying this one."),void this.destroy();if(e._instance=this,this.node.parent&&(c.addPersistRootNode(this.node),console.log("[AudioManager] Node made persistent.")),this.bgmSource||(this.bgmSource=this.node.getComponent(u),this.bgmSource||(this.bgmSource=this.node.addComponent(u),console.log("[AudioManager] Added BGM AudioSource component."))),this.bgmSource?this.bgmSource.loop=!0:g("[AudioManager] Failed to get or create BGM AudioSource!"),!this.sfxSource){var o=this.node.getComponents(u);this.sfxSource=o.find((function(e){return e!==i.bgmSource}))||null,this.sfxSource||(this.sfxSource=this.node.addComponent(u),console.log("[AudioManager] Added SFX AudioSource component."))}this.sfxSource?this.sfxSource.loop=!1:g("[AudioManager] Failed to get or create SFX AudioSource!")},r.onDestroy=function(){console.log("[AudioManager] onDestroy"),e._instance===this&&(e._instance=null)},r.initialize=function(){var i=s((function*(i){if(this._isInitialized)d("[AudioManager] Already initialized.");else if(this._isLoading)d("[AudioManager] Initialization already in progress.");else{console.log("[AudioManager] Initializing..."),this._isLoading=!0,this._isBgmEnabled=i.bgmEnabled,this._isSfxEnabled=i.sfxEnabled,console.log("[AudioManager] Initial settings - BGM: "+this._isBgmEnabled+", SFX: "+this._isSfxEnabled);try{yield this.loadAudioAssets(),this._isInitialized=!0,console.log("[AudioManager] Initialized successfully."),this._isBgmEnabled&&this.playBGM(m.AudioClipName.BGM)}catch(i){g("[AudioManager] Initialization failed during audio loading.",i)}finally{this._isLoading=!1}}}));return function(e){return i.apply(this,arguments)}}(),r.loadAudioAssets=function(){var i=s((function*(){var i=this;console.log("[AudioManager] Starting audio asset loading...");var e=Object.values(m.AudioClipName),o=[];this._audioClips.clear();for(var n=function*(){var e=a[t],n="audio/"+e;o.push(new Promise((function(o,t){p.load(n,f,(function(t,a){t?(g("[AudioManager] Failed to load audio clip: "+n,t),o()):a?(i._audioClips.set(e,a),console.log("[AudioManager] Loaded audio clip: "+n),o()):(g("[AudioManager] Loaded audio clip is null: "+n),o())}))})))},t=0,a=e;t<a.length;t++)yield*n();yield Promise.all(o),console.log("[AudioManager] Audio asset loading finished. Loaded "+this._audioClips.size+" clips.")}));return function(){return i.apply(this,arguments)}}(),r.setBgmEnabled=function(i){this._isBgmEnabled!==i&&(this._isBgmEnabled=i,console.log("[AudioManager] Set BGM Enabled: "+i),this._isInitialized?i?this._currentBgmName?this.playBGM(this._currentBgmName):this.playBGM(m.AudioClipName.BGM):this.stopBGM():d("[AudioManager] setBgmEnabled called before initialization."))},r.setSfxEnabled=function(i){this._isSfxEnabled!==i&&(this._isSfxEnabled=i,console.log("[AudioManager] Set SFX Enabled: "+i),this._isInitialized||d("[AudioManager] setSfxEnabled called before initialization."))},r.playBGM=function(i){if(this._isInitialized&&this._isBgmEnabled&&this.bgmSource){var e=this._audioClips.get(i);e?this.bgmSource.clip===e&&this.bgmSource.playing||(console.log("[AudioManager] Playing BGM: "+i),this.bgmSource.stop(),this.bgmSource.clip=e,this.bgmSource.play(),this._currentBgmName=i):d("[AudioManager] BGM clip '"+i+"' not found or not loaded.")}},r.stopBGM=function(){this._isInitialized&&this.bgmSource&&(this.bgmSource.playing&&(console.log("[AudioManager] Stopping BGM."),this.bgmSource.stop()),this._currentBgmName=null)},r.pauseBGM=function(){this._isInitialized&&this.bgmSource&&this.bgmSource.playing&&(console.log("[AudioManager] Pausing BGM."),this.bgmSource.pause())},r.resumeBGM=function(){if(this._isInitialized&&this._isBgmEnabled&&this.bgmSource)if(this._currentBgmName&&!this.bgmSource.playing){var i=this._audioClips.get(this._currentBgmName);i&&this.bgmSource.clip!==i&&(this.bgmSource.clip=i),console.log("[AudioManager] Resuming BGM."),this.bgmSource.play()}else this._currentBgmName||d("[AudioManager] Resume BGM called but no BGM was intended to be playing.")},r.playSFX=function(i,e){if(void 0===e&&(e=1),this._isInitialized&&this._isSfxEnabled&&this.sfxSource){var o=this._audioClips.get(i);o?this.sfxSource.playOneShot(o,e):d("[AudioManager] SFX clip '"+i+"' not found or not loaded.")}},r.getAudioClip=function(i){return this._audioClips.get(i)},a(e,null,[{key:"instance",get:function(){return this._instance||g("[AudioManager] Instance requested before initialization or node doesn't exist."),this._instance}}]),e}(h))._instance=null,y=e((_=x).prototype,"bgmSource",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(_.prototype,"sfxSource",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=_))||A));r._RF.pop()}}}));

System.register("chunks:///_virtual/CloudService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UserData.ts"],(function(e){var r,t,i,s,l,o,a,u;return{setters:[function(e){r=e.asyncToGenerator,t=e.extends},function(e){i=e.cclegacy,s=e.log,l=e.error,o=e.warn},function(e){a=e.createEmptyUserAccount,u=e.generateLevelRecordKey}],execute:function(){i._RF.push({},"5537cq1lTlMN6DAWCBdIkCC","CloudService",void 0);var c=e("CloudService",function(){function e(){}return e.initializeSimulatedData=function(){if(!this.isSimulatedDataInitialized){s("[CloudService (Sim)] 初始化模拟数据..."),this.simulatedUserDatabase.clear();var e=a(this.simulatedUserId);e.nickname="模拟玩家",e.avatarUrl="",this.simulatedUserDatabase.set(this.simulatedUserId,e),this.isSimulatedDataInitialized=!0,s("[CloudService (Sim)] 模拟数据初始化完成。用户:",e)}},e.callCloudFunction=function(){var e=r((function*(e,r){void 0===r&&(r={}),console.log("[CloudService] 调用云函数: "+e+", 参数:",r);try{var t=yield wx.cloud.callFunction({name:e,data:r});if(console.log("[CloudService] 云函数 "+e+" 返回:",t),"cloud.callFunction:ok"!==t.errMsg)throw new Error("调用云函数 "+e+" 失败: "+t.errMsg);if(t.result&&!1===t.result.success)throw new Error("云函数 "+e+" 执行失败: "+(t.result.message||"未知错误"));if(t.result&&t.result.code&&0!==t.result.code&&200!==t.result.code)throw new Error("云函数 "+e+" 返回错误码 "+t.result.code+": "+(t.result.message||"未知错误"));return t.result}catch(r){throw l("[CloudService] 调用云函数 "+e+" 时发生异常:",r),r}}));return function(r,t){return e.apply(this,arguments)}}(),e.authenticateUser=function(){var e=r((function*(e){if(this.isSimulatedMode){this.initializeSimulatedData(),s("[CloudService (Sim)] 模拟用户认证 (code: "+e+")");var r=!1;if(!this.simulatedUserDatabase.has(this.simulatedUserId)){r=!0;var t=a(this.simulatedUserId);t.nickname="模拟新玩家",this.simulatedUserDatabase.set(this.simulatedUserId,t),s("[CloudService (Sim)] 模拟新用户创建:",t)}return s("[CloudService (Sim)] 模拟认证成功: userId="+this.simulatedUserId+", isNewUser="+r),Promise.resolve({userId:this.simulatedUserId,isNewUser:r})}try{var i=yield this.callCloudFunction(this.CLOUD_FUNC_AUTH,{code:e});if(!i||!i.userId)throw new Error("认证云函数未返回有效的 userId。");return console.log("[CloudService] 用户认证成功: userId="+i.userId+", isNewUser="+i.isNewUser),i}catch(e){throw l("[CloudService] 用户认证失败:",e),e}}));return function(r){return e.apply(this,arguments)}}(),e.updateUserRecord=function(){var e=r((function*(e,r,t,i,o){if(this.isSimulatedMode){s("[CloudService (Sim)] 模拟更新用户记录: User="+e+", Level="+r+"-"+t+", Time="+i+"s");var a=this.simulatedUserDatabase.get(this.simulatedUserId);if(!a)return l("[CloudService (Sim)] 模拟用户 "+this.simulatedUserId+" 不存在，无法更新记录。"),Promise.resolve({success:!1});var c=u(r,t),n=a.levelRecords[c];return n?i<n.bestTimeSeconds?(s("[CloudService (Sim)] 更新最佳时间: "+i+"s (原: "+n.bestTimeSeconds+"s)"),n.bestTimeSeconds=i):s("[CloudService (Sim)] 本次用时 "+i+"s 未超过最佳时间 "+n.bestTimeSeconds+"s"):(s("[CloudService (Sim)] 添加新记录: "+c),a.levelRecords[c]={difficulty:r,levelIndex:t,bestTimeSeconds:i,firstCompletionTimestamp:o},a.totalLevelsCompleted=(a.totalLevelsCompleted||0)+1,s("[CloudService (Sim)] 用户总完成数更新为: "+a.totalLevelsCompleted)),Promise.resolve({success:!0})}try{var d=yield this.callCloudFunction(this.CLOUD_FUNC_UPDATE_RECORD,{difficulty:r,levelIndex:t,timeSeconds:i,completionTimestamp:o});if(!d||!0!==d.success)throw new Error("更新用户记录云函数执行失败或未返回成功状态。");return console.log("[CloudService] 用户记录更新成功: "+r+"-"+t+", time="+i+"s"),d}catch(e){throw l("[CloudService] 更新用户记录失败:",e),e}}));return function(r,t,i,s,l){return e.apply(this,arguments)}}(),e.fetchUserRecords=function(){var e=r((function*(e){if(this.isSimulatedMode){this.initializeSimulatedData(),s("[CloudService (Sim)] 模拟获取用户记录: User="+e);var r=this.simulatedUserDatabase.get(this.simulatedUserId);if(r&&r.levelRecords){s("[CloudService (Sim)] 返回 "+Object.keys(r.levelRecords).length+" 条模拟记录。");var t=JSON.parse(JSON.stringify(r.levelRecords));return Promise.resolve({records:t})}return console.log("[CloudService (Sim)] 模拟用户不存在或无记录，返回空记录。"),Promise.resolve({records:{}})}try{var i=yield this.callCloudFunction(this.CLOUD_FUNC_FETCH_RECORDS);return i&&"object"==typeof i.records?(console.log("[CloudService] 获取用户记录成功，共 "+Object.keys(i.records).length+" 条。"),i.records):(o("[CloudService] 获取用户记录云函数未返回有效的 records 对象，可能用户无记录。"),{})}catch(e){throw l("[CloudService] 获取用户记录失败:",e),e}}));return function(r){return e.apply(this,arguments)}}(),e.fetchGlobalRanking=function(){var e=r((function*(e){if(void 0===e&&(e=100),this.isSimulatedMode){this.initializeSimulatedData(),console.log("[CloudService (Sim)] 模拟获取排行榜数据 (limit: "+e+")");var r=Array.from(this.simulatedUserDatabase.values());r.sort((function(e,r){var t=(r.totalLevelsCompleted||0)-(e.totalLevelsCompleted||0);return 0!==t?t:0}));for(var i=[],s=void 0,o=-1,a=0;a<r.length;a++){var u=r[a],c=a+1,n={rank:c,userId:u.userId,nickname:u.nickname||"玩家"+u.userId.substring(u.userId.length-4),avatarUrl:u.avatarUrl||"",score:u.totalLevelsCompleted||0};c<=e&&i.push(n),u.userId===this.simulatedUserId&&(o=c,s=t({},n))}return console.log("[CloudService (Sim)] 生成排行榜 "+i.length+" 条。我的排名: "+(-1!==o?o:"未上榜")),Promise.resolve({ranks:i,myRank:s})}try{var d=yield this.callCloudFunction(this.CLOUD_FUNC_FETCH_RANKING,{limit:e});if(!d||!Array.isArray(d.ranks))throw new Error("获取排行榜云函数未返回有效的 ranks 数组。");return console.log("[CloudService] 获取排行榜成功，共 "+d.ranks.length+" 条。我的排名:",d.myRank),d}catch(e){throw l("[CloudService] 获取排行榜失败:",e),e}}));return function(r){return e.apply(this,arguments)}}(),e.fetchLevelData=function(){var e=r((function*(e,r){return console.log("[CloudService (Sim)] 模拟获取关卡数据: "+e+"-"+r+" (返回 null，由本地生成)"),Promise.resolve(null)}));return function(r,t){return e.apply(this,arguments)}}(),e.fetchUserAccountFromDB=function(){var e=r((function*(e){if(this.isSimulatedMode){this.initializeSimulatedData(),console.log("[CloudService (Sim)] 模拟从 DB 获取用户账户: "+e);var r=this.simulatedUserDatabase.get(e);return r?Promise.resolve(JSON.parse(JSON.stringify(r))):Promise.resolve(null)}try{var t=wx.cloud.database(),i=yield t.collection(this.DB_COLLECTION_USERS).doc(e).get();return i.data?(console.log("[CloudService] 从数据库获取用户账户成功: "+e),i.data):(o("[CloudService] 在数据库中未找到用户账户或无权限: "+e),null)}catch(r){if(-502004===r.errCode)return o("[CloudService] 数据库记录不存在: "+e),null;throw l("[CloudService] 从数据库获取用户账户失败 ("+e+"):",r),r}}));return function(r){return e.apply(this,arguments)}}(),e.upsertUserAccountToDB=function(){var e=r((function*(e){if(this.isSimulatedMode){this.initializeSimulatedData();var r=e.userId;console.log("[CloudService (Sim)] 模拟 Upsert 用户账户到 DB: "+r);var i=t({},e),s=!1,o=!1;if(this.simulatedUserDatabase.has(r)){var u=this.simulatedUserDatabase.get(r);Object.assign(u,i),o=!0,console.log("[CloudService (Sim)] 模拟更新用户: "+r)}else{var c=a(r);Object.assign(c,i),this.simulatedUserDatabase.set(r,c),s=!0,console.log("[CloudService (Sim)] 模拟创建用户: "+r)}return Promise.resolve({success:!0,created:s,updated:o})}try{var n=wx.cloud.database(),d=e.userId,v=t({},e);delete v.userId;var m=yield n.collection(this.DB_COLLECTION_USERS).doc(d).set({data:v});return console.log("[CloudService] Upsert 用户账户到数据库成功: "+d,m),m}catch(r){throw l("[CloudService] Upsert 用户账户到数据库失败 ("+e.userId+"):",r),r}}));return function(r){return e.apply(this,arguments)}}(),e}());c.CLOUD_FUNC_AUTH="authenticateUser",c.CLOUD_FUNC_UPDATE_RECORD="updateUserRecord",c.CLOUD_FUNC_FETCH_RECORDS="fetchUserRecords",c.CLOUD_FUNC_FETCH_RANKING="fetchGlobalRanking",c.CLOUD_FUNC_FETCH_LEVEL="fetchLevelData",c.DB_COLLECTION_USERS="users",c.DB_COLLECTION_LEVELS="levels",c.simulatedUserId="local_user_001",c.simulatedUserDatabase=new Map,c.isSimulatedDataInitialized=!1,c.isSimulatedMode=!0,i._RF.pop()}}}));

System.register("chunks:///_virtual/Constants.ts",["cc"],(function(_){var e;return{setters:[function(_){e=_.cclegacy}],execute:function(){e._RF.push({},"c692bpcoy1ETLTv/vs5jaWr","Constants",void 0);_("Constants",{GRID_SIZE:9,BOX_SIZE:3,Difficulty:{ENTRY:"入门",EASY:"初级",MEDIUM:"中级",HARD:"高级",MASTER:"大师级"},DifficultyEmptyCells:{ENTRY:{start:5,end:7},EASY:{start:9,end:12},MEDIUM:{start:13,end:18},HARD:{start:25,end:35},MASTER:{start:38,end:42}},LEVELS_PER_DIFFICULTY:30,StorageKeys:{SETTINGS:"sudoku_settings",UNFINISHED_GAME:"sudoku_unfinished"},SpriteFrameName:{CELL_PRESET_BG:"cell_preset_bg",CELL_USER_BG:"cell_user_bg",NUM_BTN_VALID_BG:"number_pad_bg_valid",NUM_BTN_INVALID_BG:"number_pad_bg_invalid",DEFAULT_AVATAR:"default_avatar"},IconName:{PAUSE:"icon_pause",RESUME:"icon_resume"},EventName:{CELL_CLICKED:"event_cell_clicked",NUMBER_INPUT:"event_number_input",CLEAR_BUTTON_CLICKED:"event_clear_clicked",UNDO_BUTTON_CLICKED:"event_undo_clicked",REDO_BUTTON_CLICKED:"event_redo_clicked",PAUSE_BUTTON_CLICKED:"event_pause_clicked",RESUME_BUTTON_CLICKED:"event_resume_clicked",SETTINGS_BUTTON_CLICKED:"event_settings_clicked",DIFFICULTY_SELECTED:"event_difficulty_selected",CHALLENGE_BUTTON_CLICKED:"event_challenge_clicked",SHOW_HISTORY_CLICKED:"event_show_history_clicked",SHOW_RANKING_CLICKED:"event_show_ranking_clicked",PAUSE_RESUME_BUTTON_CLICKED:"event_pause_resume_clicked",SETTINGS_BGM_CHANGED:"event_settings_bgm_changed",SETTINGS_SFX_CHANGED:"event_settings_sfx_changed",GAME_START:"event_game_start",GAME_OVER:"event_game_over",GAME_PAUSED:"event_game_paused",GAME_RESUMED:"event_game_resumed",TIMER_UPDATE:"event_timer_update",BOARD_UPDATE:"event_board_update",BOARD_COMPLETED_PART:"event_board_completed_part",UNDO_STATE_UPDATE:"event_undo_state_update",SETTINGS_CHANGED:"event_settings_changed",NUMBER_PAD_UPDATE:"event_number_pad_update",LOGIN_SUCCESS:"event_login_success",LOGIN_FAIL:"event_login_fail",USER_RECORDS_LOADED:"event_user_records_loaded",RANKING_LOADED:"event_ranking_loaded",SHOW_AD:"event_show_ad",HIDE_AD:"event_hide_ad"},Animation:{NUMBER_APPEAR_SCALE_IN:.5,NUMBER_APPEAR_SCALE_OUT:1.2,NUMBER_APPEAR_DURATION:.3,NUMBER_DISAPPEAR_SCALE:.1,NUMBER_DISAPPEAR_DURATION:.2},AudioClipName:{BGM:"bgm/bgm",CLICK:"sfx/click",FILL:"sfx/fill",CLEAR:"sfx/clear",APPLAUSE:"sfx/applause",WIN:"sfx/win"}});e._RF.pop()}}}));

System.register("chunks:///_virtual/EffectsManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts"],(function(e){var t,n,i,s,a,o,r,c,l,f,g,P,E,_,p,d,u,h,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,s=e.assertThisInitialized,a=e.createClass},function(e){o=e.cclegacy,r=e._decorator,c=e.Prefab,l=e.warn,f=e.isValid,g=e.error,P=e.ParticleSystem2D,E=e.UITransform,_=e.instantiate,p=e.UIOpacity,d=e.tween,u=e.Vec3,h=e.Component},function(e){M=e.Constants}],execute:function(){var N,A,m,w,y,R;o._RF.push({},"3c60aNfxwZNAZZPV1G98PJ3","EffectsManager",void 0);var I=r.ccclass,C=r.property;e("EffectsManager",(N=I("EffectsManager"),A=C({type:c,tooltip:"胜利时播放的粒子效果预制件"}),N(((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"winParticlesPrefab",y,s(t)),t._winParticlesNode=null,t._isInitialized=!1,t}n(t,e);var o=t.prototype;return o.onLoad=function(){if(console.log("[EffectsManager] onLoad"),t._instance&&t._instance!==this)return l("[EffectsManager] 另一个实例已存在，销毁当前实例。"),void this.destroy();t._instance=this,this._isInitialized=!0,console.log("[EffectsManager] 初始化完成。")},o.onDestroy=function(){console.log("[EffectsManager] onDestroy"),t._instance===this&&(t._instance=null,f(this._winParticlesNode)&&(this._winParticlesNode.destroy(),this._winParticlesNode=null))},o.playWinEffect=function(e,t){if(this._isInitialized)if(this.winParticlesPrefab)if(f(e)){if(f(this._winParticlesNode)){console.log("[EffectsManager] 检测到已存在的胜利粒子节点，准备重新播放。");var n=this._winParticlesNode.getComponent(P);if(n){if(console.log("[EffectsManager] 检测到已存在的胜利粒子效果，准备重新播放。"),n.stop(),n.clear(),t)console.log("[EffectsManager] 重新设置粒子位置为:",t),this._winParticlesNode.setPosition(t);else{console.log("[EffectsManager] ParticleSystem2D无效， 使用父节点的 UITransform 设置粒子位置。");var i=e.getComponent(E);i?this._winParticlesNode.setPosition(0,-i.height/2,0):this._winParticlesNode.setPosition(0,0,0)}return n&&"function"==typeof n.play?n.play():console.log("[EffectsManager] 粒子系统没有 play 方法。"),void console.log("[EffectsManager] 重新播放胜利粒子效果。")}console.log("[EffectsManager] 节点存在但没有 ParticleSystem 组件，重新创建。"),this._winParticlesNode.destroy(),this._winParticlesNode=null}if(console.log("[EffectsManager] 开始实例化胜利粒子效果。"),this._winParticlesNode=_(this.winParticlesPrefab),this._winParticlesNode){if(e.addChild(this._winParticlesNode),t)this._winParticlesNode.setPosition(t);else{console.log("[EffectsManager] position不存在， 使用父节点的 UITransform 设置粒子位置。");var s=e.getComponent(E);s?(console.log("[EffectsManager] 设置粒子位置为:",0,-s.height/2,0),this._winParticlesNode.setPosition(0,-s.height/2,0)):(console.log("[EffectsManager] 使用父节点的 Transform 设置粒子位置。"),this._winParticlesNode.setPosition(0,0,0))}console.log("[EffectsManager] 实例化完成，准备播放粒子效果。");var a=this._winParticlesNode.getComponent(P);a?(console.log("[EffectsManager] 开始播放胜利粒子效果。"),"function"==typeof a.play&&a.play()):console.error("[EffectsManager] 胜利粒子预制件上缺少 ParticleSystem 组件！")}else g("[EffectsManager] 实例化胜利粒子效果失败！")}else g("[EffectsManager] 提供的父节点无效！");else g("[EffectsManager] 胜利粒子效果预制件未设置！");else l("[EffectsManager] playWinEffect 在初始化之前被调用。")},o.stopWinEffect=function(){if(this._isInitialized){if(f(this._winParticlesNode)){console.log("[EffectsManager] 检测到正在播放的胜利粒子节点，准备停止。");var e=this._winParticlesNode.getComponent(P);e?(console.log("[EffectsManager] 检测到粒子系统组件，准备停止粒子效果。"),"function"==typeof e.stop?e.stop():console.log("[EffectsManager] 粒子系统没有 stop 方法。"),this._winParticlesNode.destroy(),this._winParticlesNode=null,console.log("[EffectsManager] 胜利粒子效果已停止并移除。")):(console.log("[EffectsManager] 检测到节点没有 ParticleSystem 组件，直接销毁。"),this._winParticlesNode.destroy(),this._winParticlesNode=null,console.log("[EffectsManager] 胜利粒子节点已移除 (无粒子系统)。"))}}else l("[EffectsManager] stopWinEffect 在初始化之前被调用。")},o.animateNumberAppear=function(e,t){if(!this._isInitialized||!f(e))return l("[EffectsManager] animateNumberAppear 调用时参数无效或未初始化。"),void(t&&t());e.setScale(M.Animation.NUMBER_APPEAR_SCALE_IN,M.Animation.NUMBER_APPEAR_SCALE_IN);var n=e.getComponent(p)||e.addComponent(p);n.opacity=0,e.active=!0,d(e).to(.7*M.Animation.NUMBER_APPEAR_DURATION,{scale:new u(M.Animation.NUMBER_APPEAR_SCALE_OUT,M.Animation.NUMBER_APPEAR_SCALE_OUT,1)},{easing:"sineOut"}).to(.3*M.Animation.NUMBER_APPEAR_DURATION,{scale:new u(1,1,1)},{easing:"sineIn"}).call((function(){t&&t()})).start(),d(n).to(.5*M.Animation.NUMBER_APPEAR_DURATION,{opacity:255}).start()},o.animateNumberDisappear=function(e,t){if(!this._isInitialized||!f(e))return l("[EffectsManager] animateNumberDisappear 调用时参数无效或未初始化。"),void(t&&t());e.getComponent(p)||e.addComponent(p);d(e).to(M.Animation.NUMBER_DISAPPEAR_DURATION,{scale:new u(M.Animation.NUMBER_DISAPPEAR_SCALE,M.Animation.NUMBER_DISAPPEAR_SCALE,1)},{easing:"sineIn"}).call((function(){e.setScale(1,1,1),t&&t()})).start()},a(t,null,[{key:"instance",get:function(){return this._instance||g("[EffectsManager] 实例在初始化之前或节点不存在时被请求。"),this._instance}}]),t}(h))._instance=null,y=t((w=R).prototype,"winParticlesPrefab",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=w))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameData.ts",["cc","./Constants.ts"],(function(t){var n,r;return{setters:[function(t){n=t.cclegacy},function(t){r=t.Constants}],execute:function(){t({cloneBoardData:function(t){var n=t.grid.map((function(t){return[].concat(t)})),r=t.presetMask.map((function(t){return[].concat(t)})),a=t.solution?t.solution.map((function(t){return[].concat(t)})):void 0;return{grid:n,presetMask:r,solution:a}},createEmptyBoardData:function(t){void 0===t&&(t=r.GRID_SIZE);for(var n=[],a=[],o=0;o<t;o++)n[o]=Array(t).fill(0),a[o]=Array(t).fill(!1);return{grid:n,presetMask:a}}}),n._RF.push({},"3cb90o0BkFB1Iuj21iElX1t","GameData",void 0),n._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts","./GameData.ts","./PersistenceManager.ts","./SudokuLogic.ts","./UIManager.ts","./GridManager.ts","./InputManager.ts","./AudioManager.ts","./EffectsManager.ts","./AccountManager.ts"],(function(e){var t,a,n,i,r,s,o,u,l,c,g,h,M,m,d,f,G,v,_,p,E,S,L,I;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose,s=e.createClass,o=e.asyncToGenerator},function(e){u=e.cclegacy,l=e._decorator,c=e.warn,g=e.director,h=e.error,M=e.log,m=e.Component},function(e){d=e.Constants},function(e){f=e.cloneBoardData},function(e){G=e.PersistenceManager},function(e){v=e.SudokuLogic},function(e){_=e.UIManager},function(e){p=e.GridManager},function(e){E=e.InputManager},function(e){S=e.AudioManager},function(e){L=e.EffectsManager},function(e){I=e.AccountManager}],execute:function(){var A,y,D,N,T,C,P,O,b,R,U,w,B,x,V,k;u._RF.push({},"bf62cThlR1HbY3WuOHd1Ez/","GameManager",void 0);var Y=l.ccclass,H=l.property,z=function(e){return e[e.LOADING=0]="LOADING",e[e.MENU=1]="MENU",e[e.LOADING_LEVEL=2]="LOADING_LEVEL",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED",e[e.LEVEL_COMPLETE=5]="LEVEL_COMPLETE",e[e.GAME_OVER=6]="GAME_OVER",e}(z||{});e("GameManager",(A=Y("GameManager"),y=H({type:_,tooltip:"UI 管理器实例"}),D=H({type:p,tooltip:"棋盘管理器实例"}),N=H({type:E,tooltip:"输入管理器实例"}),T=H({type:S,tooltip:"音频管理器实例"}),C=H({type:L,tooltip:"效果管理器实例"}),P=H({type:I,tooltip:"账户管理器实例"}),A(((k=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,n(t,"uiManager",R,i(t)),n(t,"gridManager",U,i(t)),n(t,"inputManager",w,i(t)),n(t,"audioManager",B,i(t)),n(t,"effectsManager",x,i(t)),n(t,"accountManager",V,i(t)),t._currentState=z.LOADING,t._currentDifficulty=null,t._currentLevelIndex=0,t._currentLevelData=null,t._currentGameTime=0,t._timerIntervalId=-1,t._sudokuLogic=null,t}a(t,e);var u=t.prototype;return u.onLoad=function(){return console.log("[GameManager] onLoad"),t._instance&&t._instance!==this?(c("[GameManager] 另一个实例已存在，销毁当前实例。"),void this.destroy()):(t._instance=this,this.node.parent&&(g.addPersistRootNode(this.node),console.log("[GameManager] 节点已设为持久化。")),this.uiManager?this.gridManager?this.inputManager?this.audioManager?this.effectsManager?this.accountManager?(this._sudokuLogic=v.getInstance(),this.bindEvents(),void console.log("[GameManager] 初始化完成，等待资源加载和登录...")):(h("[GameManager] 缺少必要的管理器引用accountManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)):(h("[GameManager] 缺少必要的管理器引用effectsManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)):(h("[GameManager] 缺少必要的管理器引用audioManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)):(h("[GameManager] 缺少必要的管理器引用inputManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)):(h("[GameManager] 缺少必要的管理器引用gridManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)):(h("[GameManager] 缺少必要的管理器引用uiManager，请在编辑器中设置！"),void(this._currentState=z.GAME_OVER)))},u.start=function(){var e=o((function*(){console.log("[GameManager] start - 开始初始化流程"),this.setGameState(z.LOADING);var e=G.loadSettings();console.log("[GameManager] 设置已加载:",e),yield this.audioManager.initialize(e),yield this.uiManager.preloadAssets(),this.uiManager.initialize(this.gridManager,this.effectsManager),this.gridManager.initialize(this.uiManager,this.effectsManager),this.inputManager.initialize(this.gridManager,this.uiManager,this.audioManager,this.effectsManager),yield this.accountManager.login();var t=G.loadUnfinishedGame(),a=!0;if(t){var n=this.accountManager.getUserId();null!==n&&t.userId===n?(M("[GameManager] 发现当前用户的游戏存档，尝试恢复..."),this.continueSavedGame(t),a=!1):(M("[GameManager] 发现无效或不匹配的游戏存档，将其忽略并清除。"),G.clearUnfinishedGame())}else M("[GameManager] 没有找到游戏存档。");a&&(M("[GameManager] 开始默认游戏 (入门级第一关)。"),this.startNewGame(d.Difficulty.ENTRY,1))}));return function(){return e.apply(this,arguments)}}(),u.onDestroy=function(){console.log("[GameManager] onDestroy"),t._instance===this&&(t._instance=null),this.stopTimer(),this.unbindEvents()},u.bindEvents=function(){console.log("[GameManager] Binding events..."),g.on(d.EventName.DIFFICULTY_SELECTED,this.onDifficultySelected,this),g.on(d.EventName.GAME_OVER,this.onGameOver,this),g.on(d.EventName.PAUSE_RESUME_BUTTON_CLICKED,this.onPauseResumeClicked,this),g.on(d.EventName.SETTINGS_BUTTON_CLICKED,this.onSettingsClicked,this),g.on(d.EventName.SETTINGS_BGM_CHANGED,this.onBgmSettingChanged,this),g.on(d.EventName.SETTINGS_SFX_CHANGED,this.onSfxSettingChanged,this),g.on(d.EventName.SHOW_HISTORY_CLICKED,this.onShowHistory,this),g.on(d.EventName.SHOW_RANKING_CLICKED,this.onShowRanking,this),g.on(d.EventName.CHALLENGE_BUTTON_CLICKED,this.onChallengeClicked,this),g.on(d.EventName.LOGIN_SUCCESS,this.onLoginSuccess,this)},u.unbindEvents=function(){console.log("[GameManager] Unbinding events..."),g.targetOff(this)},u.onDifficultySelected=function(e){var t;if(this._currentState===z.MENU){console.log("[GameManager] 难度选择事件: "+e);var a=this.findHighestCompletedLevel(e),n=a?Math.min(a.levelIndex+1,d.LEVELS_PER_DIFFICULTY):1;M("[GameManager] 玩家在此难度最高完成至 "+(null!=(t=null==a?void 0:a.levelIndex)?t:0)+" 关，开始第 "+n+" 关。"),this.startNewGame(e,n)}else c("[GameManager] 在非菜单状态下选择了难度，忽略。")},u.onGameOver=function(e){var t,a,n,i=this;this._currentState===z.PLAYING&&(console.log("[GameManager] 游戏结束事件: isWin="+e),this.stopTimer(),e?(this.setGameState(z.LEVEL_COMPLETE),null==(t=this.uiManager)||t.showWinAnimation(),null==(a=this.audioManager)||a.playSFX(d.AudioClipName.WIN),null==(n=this.accountManager)||n.saveLevelResult(this._currentDifficulty,this._currentLevelIndex,this._currentGameTime).then((function(e){e?console.log("[GameManager] 关卡结果成功保存到云端。"):c("[GameManager] 关卡结果保存到云端失败。")})),G.clearUnfinishedGame(),this.scheduleOnce((function(){i._currentLevelIndex<d.LEVELS_PER_DIFFICULTY?i.startNewGame(i._currentDifficulty,i._currentLevelIndex+1):(console.log("[GameManager] 已完成当前难度的所有关卡！"),i.goToMenu())}),3)):(this.setGameState(z.GAME_OVER),this.goToMenu()))},u.onPauseResumeClicked=function(){this._currentState===z.PLAYING?this.pauseGame():this._currentState===z.PAUSED?this.resumeGame():c("[GameManager] 在非游戏或暂停状态下点击了暂停/恢复按钮。")},u.onSettingsClicked=function(){this._currentState===z.PLAYING&&this.pauseGame(!1)},u.onBgmSettingChanged=function(e){var t;console.log("[GameManager] BGM 设置改变: "+e),null==(t=this.audioManager)||t.setBgmEnabled(e);var a=G.loadSettings();a.bgmEnabled=e,G.saveSettings(a)},u.onSfxSettingChanged=function(e){var t;console.log("[GameManager] SFX 设置改变: "+e),null==(t=this.audioManager)||t.setSfxEnabled(e);var a=G.loadSettings();a.sfxEnabled=e,G.saveSettings(a)},u.onShowHistory=function(){var e=o((function*(){var e,t;if(null!=(e=this.accountManager)&&e.isLoggedIn()){console.log("[GameManager] 请求显示历史记录...");var a=this.accountManager.getAllLevelRecords();null==(t=this.uiManager)||t.showHistoryPopup(a)}else c("[GameManager] 用户未登录，无法显示历史记录。")}));return function(){return e.apply(this,arguments)}}(),u.onShowRanking=function(){var e=o((function*(){var e;if(null!=(e=this.accountManager)&&e.isLoggedIn()){console.log("[GameManager] 请求显示排行榜...");try{var t,a=yield CloudService.fetchGlobalRanking();null==(t=this.uiManager)||t.showRankingPopup(a.ranks,a.myRank)}catch(e){h("[GameManager] 获取排行榜数据失败:",e)}}else c("[GameManager] 用户未登录，无法显示排行榜。")}));return function(){return e.apply(this,arguments)}}(),u.onChallengeClicked=function(e,t){console.log("[GameManager] 重新挑战请求: "+e+" - "+t),this.startNewGame(e,t)},u.onLoginSuccess=function(e){console.log("[GameManager] 登录成功事件，用户 ID: "+e)},u.startNewGame=function(){var e=o((function*(e,t){var a,n;if(M("[GameManager] 开始新游戏: "+e+" - "+t),this._currentState!==z.LOADING_LEVEL){this.setGameState(z.LOADING_LEVEL),null==(a=this.uiManager)||a.closeAllPopups(),null==(n=this.effectsManager)||n.stopWinEffect(),this._currentDifficulty=e,this._currentLevelIndex=t,this._currentGameTime=0;try{var i,r=yield this.loadLevelDataAsync(e,t);if(!r)throw new Error("无法加载关卡数据: "+e+" - "+t);this._currentLevelData=r;var s=this.gridManager.loadLevel(r);if(!s)throw new Error("棋盘管理器加载关卡失败！");this.inputManager.reset(s),null==(i=this.uiManager)||i.updateTimer(this._currentGameTime),M("[GameManager] 开始播放预设数字动画..."),this.inputManager&&this.inputManager.setInputEnabled(!1),yield this.gridManager.revealPresetNumbersAnimated(15),M("[GameManager] 预设数字动画完成。"),this.inputManager&&this.inputManager.setInputEnabled(!0),this.startTimer(),this.setGameState(z.PLAYING),M("[GameManager] 关卡加载完成，游戏开始！")}catch(e){h("[GameManager] 开始新游戏时发生错误:",e)}}else c("[GameManager] 正在加载关卡中，请稍候...")}));return function(t,a){return e.apply(this,arguments)}}(),u.continueSavedGame=function(e){var t,a;if(M("[GameManager] 继续已保存的游戏..."),this._currentState!==z.LOADING_LEVEL){this.setGameState(z.LOADING_LEVEL),null==(t=this.uiManager)||t.closeAllPopups(),null==(a=this.effectsManager)||a.stopWinEffect(),this._currentDifficulty=e.difficulty,this._currentLevelIndex=e.levelIndex,this._currentGameTime=e.elapsedTime;var n,i,r,s={difficulty:e.difficulty,levelIndex:e.levelIndex,initialBoard:e.currentBoardState,emptyCellsCount:0};if(this.gridManager.loadLevel(s))this.inputManager.reset(f(e.currentBoardState)),null==(n=this.uiManager)||n.showGameUI(),null==(i=this.uiManager)||i.updateTimer(this._currentGameTime),null==(r=this.uiManager)||r.updatePauseResumeButton(!1),this.startTimer(),this.setGameState(z.PLAYING),M("[GameManager] 已恢复游戏进度。");else h("[GameManager] 棋盘管理器加载已保存的游戏失败！"),G.clearUnfinishedGame(),this.goToErrorState()}else c("[GameManager] 正在加载关卡中，无法同时恢复游戏。")},u.findHighestCompletedLevel=function(e){var t,a=null==(t=this.accountManager)?void 0:t.getAllLevelRecords();if(!a||0===a.length)return null;for(var n,i=0,s=null,o=r(a);!(n=o()).done;){var u=n.value;u.difficulty===e&&u.levelIndex>i&&(i=u.levelIndex,s=u)}return s},u.goToErrorState=function(){this.goToMenu()},u.loadLevelDataAsync=function(){var e=o((function*(e,t){console.log("[GameManager] 异步加载关卡数据: "+e+" - "+t);var a=this._sudokuLogic.generateSudoku(e,t);if(a){for(var n=0,i=0;i<d.GRID_SIZE;i++)for(var r=0;r<d.GRID_SIZE;r++)0===a.grid[i][r]&&n++;return{difficulty:e,levelIndex:t,initialBoard:a,emptyCellsCount:n}}return null}));return function(t,a){return e.apply(this,arguments)}}(),u.pauseGame=function(e){var t;if(void 0===e&&(e=!0),this._currentState===z.PLAYING&&(console.log("[GameManager] 暂停游戏. Show ad: "+e),this.setGameState(z.PAUSED),this.stopTimer(),null==(t=this.uiManager)||t.updatePauseResumeButton(!0),e)){var a;null==(a=this.uiManager)||a.showAdOverlay()}},u.resumeGame=function(){var e,t,a;this._currentState===z.PAUSED||this.isPopupActive(this.settingsPopupPrefab)?(console.log("[GameManager] 恢复游戏。"),null==(e=this.uiManager)||e.closeAllPopups(),null==(t=this.uiManager)||t.hideAdOverlay(),this.setGameState(z.PLAYING),this.startTimer(),null==(a=this.uiManager)||a.updatePauseResumeButton(!1)):c("[GameManager] 无法从当前状态 "+this._currentState+" 恢复游戏。")},u.isPopupActive=function(e){var t,a;return!!e&&(null!=(t=null==(a=this.uiManager)?void 0:a.isPopupActive(e.name))&&t)},u.goToMenu=function(){var e;(console.log("[GameManager] 返回主菜单。"),this._currentState!==z.MENU)&&(this.setGameState(z.MENU),this.stopTimer(),null==(e=this.uiManager)||e.showDifficultySelection(),this._currentDifficulty=null,this._currentLevelIndex=0,this._currentLevelData=null)},u.saveCurrentGame=function(){var e,t;if(this._currentState===z.PLAYING||this._currentState===z.PAUSED)if(this._currentDifficulty&&this._currentLevelData&&null!=(e=this.inputManager)&&e.getCurrentBoardData()){var a={userId:(null==(t=this.accountManager)?void 0:t.getUserId())||null,difficulty:this._currentDifficulty,levelIndex:this._currentLevelIndex,currentBoardState:f(this.inputManager.getCurrentBoardData()),elapsedTime:this._currentGameTime};G.saveUnfinishedGame(a),console.log("[GameManager] 当前游戏状态已保存到本地。")}else c("[GameManager] 缺少必要数据，无法保存当前游戏。")},u.startTimer=function(){var e=this;this.stopTimer(),console.log("[GameManager] 启动计时器。"),this._timerIntervalId=setInterval((function(){var t;e._currentGameTime++,null==(t=e.uiManager)||t.updateTimer(e._currentGameTime)}),1e3)},u.stopTimer=function(){-1!==this._timerIntervalId&&(console.log("[GameManager] 停止计时器。"),clearInterval(this._timerIntervalId),this._timerIntervalId=-1)},u.setGameState=function(e){this._currentState!==e&&(console.log("[GameManager] 状态改变: "+z[this._currentState]+" -> "+z[e]),this._currentState=e,e!==z.PLAYING&&e!==z.PAUSED&&this.saveCurrentGame())},u.onGameShow=function(){var e;(console.log("[GameManager] 游戏切换到前台 (onShow)"),this._currentState===z.PLAYING||this._currentState===z.PAUSED)&&(null==(e=this.audioManager)||e.resumeBGM())},u.onGameHide=function(){var e;console.log("[GameManager] 游戏切换到后台 (onHide)"),this._currentState===z.PLAYING?(this.pauseGame(!1),this.saveCurrentGame()):this._currentState===z.PAUSED&&this.saveCurrentGame(),null==(e=this.audioManager)||e.pauseBGM()},s(t,null,[{key:"instance",get:function(){return t._instance||h("[GameManager] 实例在初始化之前或节点不存在时被请求。"),t._instance}}]),t}(m))._instance=null,R=t((b=k).prototype,"uiManager",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(b.prototype,"gridManager",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(b.prototype,"inputManager",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(b.prototype,"audioManager",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(b.prototype,"effectsManager",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(b.prototype,"accountManager",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=b))||O));u._RF.pop()}}}));

System.register("chunks:///_virtual/GridCell.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,l,o,s,u,a,c,p,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,l=e.createClass},function(e){o=e.cclegacy,s=e._decorator,u=e.Sprite,a=e.Node,c=e.Color,p=e.Button,h=e.Component}],execute:function(){var g,d,y,b,f,m,v,_,C;o._RF.push({},"80743Ot10FKrrPUCH1OKjlO","GridCell",void 0);var D=s.ccclass,S=s.property;e("GridCell",(g=D("GridCell"),d=S({type:u,tooltip:"背景 Sprite 组件"}),y=S({type:a,tooltip:"用于显示数字的节点 (可以是 Sprite 或 Label)"}),b=S({type:u,tooltip:"高亮状态的 Sprite 组件 (可选)"}),g((v=t((m=function(e){function t(){for(var t,i=arguments.length,l=new Array(i),o=0;o<i;o++)l[o]=arguments[o];return t=e.call.apply(e,[this].concat(l))||this,r(t,"bgSprite",v,n(t)),r(t,"numberDisplayNode",_,n(t)),r(t,"highlightSprite",C,n(t)),t._row=-1,t._col=-1,t._isPreset=!1,t._currentValue=0,t}i(t,e);var o=t.prototype;return o.init=function(e,t){this._row=e,this._col=t},o.updateDisplay=function(e,t,i){this._currentValue=e,this._isPreset=t;var r=new c(204,204,204,255);if(this.numberDisplayNode){var n,l=this.numberDisplayNode.getComponent(u);e>0?(this.numberDisplayNode.active=!0,console.log("[GridCell] 更新数字: "+e+"，预设: "+t),l&&i?(l.spriteFrame=i,t&&(l.color=r)):console.warn("[GridCell] 未找到数字显示组件 (Sprite 或 Label)。")):(console.log("[GridCell] 清除数字: "+e),l.spriteFrame=null,this.numberDisplayNode.active=!1),console.log("[GridCell] 数字显示节点状态: cell "+this.node.active+" button "+(null==(n=this.getComponent(p))?void 0:n.node.active)+" number "+this.numberDisplayNode.active+" highlight "+this.highlightSprite.node.active)}},o.setHighlight=function(e){this.highlightSprite&&(this.highlightSprite.node.active=e,console.log("[GridCell] setHighlight:"+e))},o.getNumberDisplayNode=function(){return this.numberDisplayNode},o.onDestroy=function(){},l(t,[{key:"row",get:function(){return this._row}},{key:"col",get:function(){return this._col}},{key:"value",get:function(){return this._currentValue}},{key:"isPreset",get:function(){return this._isPreset}}]),t}(h)).prototype,"bgSprite",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(m.prototype,"numberDisplayNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(m.prototype,"highlightSprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=m))||f));o._RF.pop()}}}));

System.register("chunks:///_virtual/GridManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts","./GameData.ts","./GridCell.ts"],(function(e){var r,i,l,t,a,n,o,s,d,c,g,u,f,h,p,C,v,M,_,G,m;return{setters:[function(e){r=e.applyDecoratedDescriptor,i=e.inheritsLoose,l=e.initializerDefineProperty,t=e.assertThisInitialized,a=e.asyncToGenerator,n=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,s=e._decorator,d=e.Prefab,c=e.Node,g=e.error,u=e.director,f=e.warn,h=e.isValid,p=e.UIOpacity,C=e.Component,v=e.instantiate,M=e.log},function(e){_=e.Constants},function(e){G=e.cloneBoardData},function(e){m=e.GridCell}],execute:function(){var y,I,D,N,b,E,R;o._RF.push({},"dcf23slAg1Isov8T9E0R5KE","GridManager",void 0);var S=s.ccclass,z=s.property;e("GridManager",(y=S("GridManager"),I=z({type:d,tooltip:"单个棋盘格子的预制件"}),D=z({type:c,tooltip:"格子高亮效果节点 (可选, 如果高亮是附加在格子上的)"}),y((E=r((b=function(e){function r(){for(var r,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return r=e.call.apply(e,[this].concat(a))||this,l(r,"cellPrefab",E,t(r)),l(r,"highlightNode",R,t(r)),r._currentSelectedNode=null,r._gridCells=[],r._currentBoardData=null,r._isInitialized=!1,r._presetCellsToReveal=[],r.uiManager=null,r.effectsManager=null,r}i(r,e);var o=r.prototype;return o.initialize=function(e,r){console.log("[GridManager] Initializing..."),this.uiManager=e,this.effectsManager=r,this.cellPrefab?this.uiManager?this.effectsManager?(this.createGridCells(),this._isInitialized=!0,console.log("[GridManager] Initialized successfully.")):g("[GridManager] EffectsManager instance is required!"):g("[GridManager] UIManager instance is required!"):g("[GridManager] Cell Prefab 未设置!")},o.createGridCells=function(){var e=this;console.log("[GridManager] Creating grid cells..."),this.node.removeAllChildren(),this._gridCells=[];for(var r=_.GRID_SIZE,i=function(i){e._gridCells[i]=[];for(var l=function(r){var l=v(e.cellPrefab);if(!l)return g("[GridManager] 实例化格子 ("+i+", "+r+") 失败!"),1;e.node.addChild(l),e._gridCells[i][r]=l,l.on(c.EventType.TOUCH_END,(function(l){e.onCellNodeClicked(i,r),l.propagationStopped=!0}),e)},t=0;t<r;t++)l(t)},l=0;l<r;l++)i(l);console.log("[GridManager] "+r*r+" grid cells created.")},o.onCellNodeClicked=function(e,r){console.log("[GridManager] Cell node clicked: ("+e+", "+r+"). Emitting event."),u.emit(_.EventName.CELL_CLICKED,e,r)},o.shuffleArray=function(e){for(var r=e.length-1;r>0;r--){var i=Math.floor(Math.random()*(r+1)),l=[e[i],e[r]];e[r]=l[0],e[i]=l[1]}return e},o.delay=function(e){return new Promise((function(r){return setTimeout(r,e)}))},o.loadLevel=function(e){if(!this._isInitialized)return console.error("[GridManager] loadLevel 在初始化之前被调用。"),null;console.log("[GridManager] Loading level: "+e.difficulty+" - "+e.levelIndex),console.log("[GridManager] level data: "+e.initialBoard),this._currentBoardData=G(e.initialBoard),this._presetCellsToReveal=[];for(var r=_.GRID_SIZE,i=0;i<r;i++)for(var l=0;l<r;l++)if(this._gridCells[i]&&this._gridCells[i][l]){var t=this._gridCells[i][l],a=this._currentBoardData.grid[i][l],n=this._currentBoardData.presetMask[i][l];this.updateCellNode(t,a,n,!0),n&&a>0&&this._presetCellsToReveal.push({row:i,col:l,value:a})}else f("[GridManager] 格子节点 ("+i+", "+l+") 无效，跳过加载。");return console.log("[GridManager] Level loaded onto grid."),G(this._currentBoardData)},o.updateCellNode=function(e,r,i,l){if(void 0===l&&(l=!1),h(e)&&this.uiManager){var t=e.getComponent(m);if(t&&(t.updateDisplay(r,i,this.uiManager.getNumberSpriteFrame(r)),l&&i&&r>0)){console.log("[GridManager] 初始加载时隐藏预设数字: ("+t.row+", "+t.col+") = "+r);var a=t.getNumberDisplayNode();if(a)a.setScale(1,1,1),(a.getComponent(p)||a.addComponent(p)).opacity=255}}},o.revealPresetNumbersAnimated=function(){var e=a((function*(e){if(void 0===e&&(e=50),this._isInitialized&&this.effectsManager)if(0!==this._presetCellsToReveal.length){M("[GridManager] 开始播放 "+this._presetCellsToReveal.length+" 个预设数字的显示动画...");for(var r,i=this.shuffleArray([].concat(this._presetCellsToReveal)),l=n(i);!(r=l()).done;){var t=r.value,a=this.getCellNode(t.row,t.col);if(h(a)){var o=null,s=a.getComponent(m);s&&(s.updateDisplay(t.value,!0,this.uiManager.getNumberSpriteFrame(t.value)),(o=s.getNumberDisplayNode())?this.effectsManager.animateNumberAppear(o):f("[GridManager] 未找到格子 ("+t.row+", "+t.col+") 的 NumberDisplay 节点用于动画。"))}else f("[GridManager] 未找到格子 ("+t.row+", "+t.col+") 节点用于动画。");yield this.delay(e)}M("[GridManager] 所有预设数字动画已开始播放。"),this._presetCellsToReveal=[]}else M("[GridManager] 没有预设数字需要显示动画。");else f("[GridManager] revealPresetNumbersAnimated 调用时未初始化或缺少 EffectsManager。")}));return function(r){return e.apply(this,arguments)}}(),o.updateCellDisplay=function(e,r,i,l){if(this._isInitialized)if(e<0||e>=_.GRID_SIZE||r<0||r>=_.GRID_SIZE)console.error("[GridManager] updateCellDisplay 收到无效的行列索引: ("+e+", "+r+")");else if(this._gridCells[e]&&this._gridCells[e][r]){var t=this._gridCells[e][r];console.log("[GridManager] Updating cell display: ("+e+", "+r+"), "+l+" to "+i+" "),this.updateCellNode(t,i,l)}else console.warn("[GridManager] 格子节点 ("+e+", "+r+") 无效，无法更新显示。");else console.warn("[GridManager] updateCellDisplay 在初始化之前被调用。")},o.highlightCell=function(e,r){var i;if(console.log("[GridManager] Highlighting cell: ("+e+", "+r+")"),this._isInitialized&&!(e<0||e>=_.GRID_SIZE||r<0||r>=_.GRID_SIZE)){this.deselectCell();var l,t=null==(i=this._gridCells[e])?void 0:i[r];if(h(t))null==(l=t.getComponent(m))||l.setHighlight(!0),t.getComponent(m)&&t.getComponent(m).getComponent(p)&&console.log("[GridManager] 格子 ("+e+", "+r+") 高亮节点已启用。"+t.getComponent(m).getComponent(p).opacity),this._currentSelectedNode=t;else console.warn("[GridManager] 未找到格子 ("+e+", "+r+") 节点用于高亮。")}},o.deselectCell=function(){var e;(console.log("[GridManager] Deselecting current cell."),this._isInitialized)&&(this._currentSelectedNode&&(null==(e=this._currentSelectedNode.getComponent(m))||e.setHighlight(!1),this._currentSelectedNode=null))},o.getCellNode=function(e,r){var i,l;return!this._isInitialized||e<0||e>=_.GRID_SIZE||r<0||r>=_.GRID_SIZE?null:null!=(i=null==(l=this._gridCells[e])?void 0:l[r])?i:null},r}(C)).prototype,"cellPrefab",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=r(b.prototype,"highlightNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=b))||N));o._RF.pop()}}}));

System.register("chunks:///_virtual/HistoryItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts"],(function(t){var e,i,n,o,l,r,a,s,c,u,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){l=t.cclegacy,r=t._decorator,a=t.Label,s=t.Button,c=t.director,u=t.Component},function(t){f=t.Constants}],execute:function(){var h,p,b,d,y,g,m,L,v,C,I,D,T;l._RF.push({},"a5825ffMHNIsIdKz29Zpkf4","HistoryItem",void 0);var _=r.ccclass,H=r.property;t("HistoryItem",(h=_("HistoryItem"),p=H({type:a,tooltip:"显示难度的 Label"}),b=H({type:a,tooltip:"显示关卡序号的 Label"}),d=H({type:a,tooltip:"显示最佳用时的 Label"}),y=H({type:a,tooltip:"显示首次完成日期的 Label"}),g=H({type:s,tooltip:"再次挑战按钮"}),h((v=e((L=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),r=0;r<i;r++)l[r]=arguments[r];return e=t.call.apply(t,[this].concat(l))||this,n(e,"difficultyLabel",v,o(e)),n(e,"levelLabel",C,o(e)),n(e,"bestTimeLabel",I,o(e)),n(e,"dateLabel",D,o(e)),n(e,"challengeButton",T,o(e)),e._recordData=null,e}i(e,t);var l=e.prototype;return l.onLoad=function(){var t;null==(t=this.challengeButton)||t.node.on(s.EventType.CLICK,this.onChallengeClick,this)},l.setData=function(t){if(this._recordData=t,!t)return console.log("[HistoryItem] 设置了空的记录数据。"),void(this.node.active=!1);if(this.node.active=!0,this.difficultyLabel&&(this.difficultyLabel.string=t.difficulty),this.levelLabel&&(this.levelLabel.string="第 "+t.levelIndex+" 关"),this.bestTimeLabel&&(this.bestTimeLabel.string="最佳: "+this.formatTime(t.bestTimeSeconds)),this.dateLabel){var e=new Date(t.firstCompletionTimestamp);this.dateLabel.string=e.getFullYear()+"-"+(e.getMonth()+1).toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")}},l.onChallengeClick=function(){this._recordData?(console.log("[HistoryItem] 挑战按钮点击: "+this._recordData.difficulty+" - "+this._recordData.levelIndex),c.emit(f.EventName.CHALLENGE_BUTTON_CLICKED,this._recordData.difficulty,this._recordData.levelIndex)):console.log("[HistoryItem] 挑战按钮点击时记录数据为空。")},l.formatTime=function(t){if(isNaN(t)||t<0)return"00:00";var e=Math.floor(t/60),i=Math.floor(t%60);return e.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")},l.onDestroy=function(){this.challengeButton?this.challengeButton.node?this.challengeButton.node.off(s.EventType.CLICK,this.onChallengeClick,this):console.error("ChallengeButton node is not set in HistoryItem!"):console.error("ChallengeButton is not set in HistoryItem!")},e}(u)).prototype,"difficultyLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(L.prototype,"levelLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(L.prototype,"bestTimeLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(L.prototype,"dateLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(L.prototype,"challengeButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=L))||m));l._RF.pop()}}}));

System.register("chunks:///_virtual/HistoryPopupController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts"],(function(e){var o,r,t,n,i,l,p,c,u;return{setters:[function(e){o=e.applyDecoratedDescriptor,r=e.inheritsLoose,t=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,p=e.ScrollView,c=e.Node},function(e){u=e.PopupBase}],execute:function(){var a,s,f,y,P,b,d;i._RF.push({},"b560ffBY+pNJKP4ePxZJGmJ","HistoryPopupController",void 0);var h=l.ccclass,g=l.property;e("HistoryPopupController",(a=h("HistoryPopupController"),s=g(p),f=g(c),a((b=o((P=function(e){function o(){for(var o,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return o=e.call.apply(e,[this].concat(i))||this,t(o,"scrollView",b,n(o)),t(o,"contentNode",d,n(o)),o}return r(o,e),o.prototype.onOpen=function(o){e.prototype.onOpen.call(this,o)},o}(u)).prototype,"scrollView",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=o(P.prototype,"contentNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/InputManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts","./ActionRecord.ts","./SudokuLogic.ts","./GameData.ts"],(function(e){var t,n,a,o,i,l,s,r,u,c,d,h;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,a=e._decorator,o=e.error,i=e.director,l=e.warn,s=e.log,r=e.Component},function(e){u=e.Constants},function(e){c=e.ActionRecord},function(e){d=e.SudokuLogic},function(e){h=e.cloneBoardData}],execute:function(){var p;n._RF.push({},"ba489B4zSRCKKBvaBW6pI7f","InputManager",void 0);var g=a.ccclass;a.property,e("InputManager",g("InputManager")(p=function(e){function n(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).gridManager=null,t.sudokuLogic=null,t.uiManager=null,t.audioManager=null,t.effectsManager=null,t._selectedRow=-1,t._selectedCol=-1,t._undoStack=[],t._redoStack=[],t._isInputEnabled=!1,t._currentBoardData=null,t}t(n,e);var a=n.prototype;return a.initialize=function(e,t,n,a){console.log("[InputManager] Initializing..."),this.gridManager=e,this.uiManager=t,this.audioManager=n,this.effectsManager=a,this.sudokuLogic=d.getInstance(),this.gridManager&&this.uiManager&&this.audioManager&&this.effectsManager&&this.sudokuLogic?(i.on(u.EventName.CELL_CLICKED,this.onCellClicked,this),i.on(u.EventName.NUMBER_INPUT,this.onNumberInput,this),i.on(u.EventName.CLEAR_BUTTON_CLICKED,this.onClearButtonClicked,this),i.on(u.EventName.UNDO_BUTTON_CLICKED,this.onUndoButtonClicked,this),i.on(u.EventName.REDO_BUTTON_CLICKED,this.onRedoButtonClicked,this),console.log("[InputManager] Initialized successfully and listening for UI events.")):o("[InputManager] Initialization failed: Missing required manager instances.")},a.reset=function(e){console.log("[InputManager] Resetting state."),this._selectedRow=-1,this._selectedCol=-1,this._undoStack=[],this._redoStack=[],this._isInputEnabled=!0,this._currentBoardData=e,this.updateUndoRedoState(),this.updateNumberPadState()},a.onCellClicked=function(e,t){var n,a;console.log("[InputManager] Cell clicked: ("+e+", "+t+")"),this._isInputEnabled&&this._currentBoardData&&(this._currentBoardData.presetMask[e][t]?console.log("[InputManager] Clicked on a preset cell. Ignoring selection."):this._selectedRow!==e||this._selectedCol!==t?(this._selectedRow=e,this._selectedCol=t,null==(n=this.uiManager)||n.highlightCell(e,t),null==(a=this.audioManager)||a.playSFX(u.AudioClipName.CLICK),this.updateNumberPadState()):this.deselectCurrentCell())},a.onNumberInput=function(e){var t,n,a=this;if(this._isInputEnabled&&-1!==this._selectedRow&&-1!==this._selectedCol&&this._currentBoardData){var o=this._selectedRow,i=this._selectedCol;if(this._currentBoardData.presetMask[o][i])l("[InputManager] Attempted to input number into a preset cell.");else if(this.sudokuLogic.isValidMove(this._currentBoardData,o,i,e)){var s=this._currentBoardData.grid[o][i];s!==e?(console.log("[InputManager] Inputting number "+e+" at ("+o+", "+i+"). Previous value: "+s+" set _isInputEnabled to false"),this._isInputEnabled=!1,null==(t=this.audioManager)||t.playSFX(u.AudioClipName.FILL),null==(n=this.uiManager)||n.playInputAnimation(o,i,e,(function(){a.performFillAction(o,i,e,s),a._isInputEnabled=!0}))):console.log("[InputManager] 输入数字与当前格子数字相同，则视为无效操作.")}else console.log("[InputManager] Invalid move: Placing "+e+" at ("+o+", "+i+") creates a conflict.")}else console.log("[InputManager] Number input ignored: No cell selected or input disabled.")},a.onClearButtonClicked=function(){var e,t,n=this;if(this._isInputEnabled&&-1!==this._selectedRow&&-1!==this._selectedCol&&this._currentBoardData){var a=this._selectedRow,o=this._selectedCol;if(this._currentBoardData.presetMask[a][o])console.warn("[InputManager] Attempted to clear a preset cell.");else{var i=this._currentBoardData.grid[a][o];0!==i?(this._isInputEnabled=!1,null==(e=this.audioManager)||e.playSFX(u.AudioClipName.CLEAR),console.log("[InputManager] 开始清理 ("+a+", "+o+"). 原先数字为 : "+i),null==(t=this.uiManager)||t.playClearAnimation(a,o,(function(){n.performClearAction(a,o,i),n._isInputEnabled=!0}))):console.log("[InputManager] 格子本来就是空的，则无需操作.")}}else console.log("[InputManager] Clear ignored: No cell selected or input disabled.")},a.switchHighlight=function(e,t){var n;this._selectedRow=e,this._selectedCol=t,null==(n=this.uiManager)||n.highlightCell(e,t)},a.onUndoButtonClicked=function(){var e;if(this._isInputEnabled&&0!==this._undoStack.length){var t,n,a=this._undoStack.pop();if(console.log("[InputManager] Undoing action: type="+a.type+", cell=("+a.row+", "+a.col+"), prev="+a.previousValue+", new="+a.newValue),"fill"===a.type)null==(t=this.uiManager)||t.playInputAnimation(a.row,a.col,a.previousValue,(function(){}));else null==(n=this.uiManager)||n.playClearAnimation(a.row,a.col,(function(){}));this.switchHighlight(a.row,a.col),this._redoStack.push(a),this.updateGridCellValue(a.row,a.col,a.previousValue),null==(e=this.audioManager)||e.playSFX(u.AudioClipName.CLICK),this.updateUndoRedoState(),this.updateNumberPadState(),this.checkCompletionAfterUpdate(a.row,a.col)}else console.log("[InputManager] Undo ignored: Stack empty or input disabled.")},a.onRedoButtonClicked=function(){var e;if(this._isInputEnabled&&0!==this._redoStack.length){var t,n,a=this._redoStack.pop();if(console.log("[InputManager] Redoing action: type="+a.type+", cell=("+a.row+", "+a.col+"), prev="+a.previousValue+", new="+a.newValue),this.switchHighlight(a.row,a.col),"fill"===a.type)null==(t=this.uiManager)||t.playInputAnimation(a.row,a.col,a.newValue,(function(){}));else null==(n=this.uiManager)||n.playClearAnimation(a.row,a.col,(function(){}));this._undoStack.push(a),this.updateGridCellValue(a.row,a.col,a.newValue),null==(e=this.audioManager)||e.playSFX(u.AudioClipName.CLICK),this.updateUndoRedoState(),this.updateNumberPadState(),this.checkCompletionAfterUpdate(a.row,a.col)}else console.log("[InputManager] Redo ignored: Stack empty or input disabled.")},a.performFillAction=function(e,t,n,a){this.updateGridCellValue(e,t,n);var o=new c("fill",e,t,a,n);this.recordAction(o),this.updateNumberPadState(),this.checkCompletionAfterUpdate(e,t)},a.performClearAction=function(e,t,n){console.log("[InputManager] performClearAction: row="+e+", col="+t+", prevValue="+n),this.updateGridCellValue(e,t,0);var a=new c("clear",e,t,n,0);this.recordAction(a),this.updateNumberPadState()},a.getCurrentBoardData=function(){return this._currentBoardData?h(this._currentBoardData):(l("[InputManager] 尝试获取棋盘数据，但内部缓存为空。"),null)},a.setInputEnabled=function(e){s("[InputManager] 设置输入状态: "+e),this._isInputEnabled=e},a.updateGridCellValue=function(e,t,n){console.log("[InputManager] Updating cell ("+e+", "+t+") to value: "+n),this._currentBoardData?this._currentBoardData.grid[e][t]=n:console.warn("[InputManager] 尝试更新格子，但当前棋盘数据为空。")},a.recordAction=function(e){this._undoStack.push(e),this._redoStack=[],this.updateUndoRedoState()},a.updateUndoRedoState=function(){var e,t=this._undoStack.length>0,n=this._redoStack.length>0;null==(e=this.uiManager)||e.updateUndoRedoButtons(t,n)},a.updateNumberPadState=function(){var e;if(console.log("[InputManager] Updating number pad state., row "+this._selectedRow+", col "+this._selectedCol),-1!==this._selectedRow&&-1!==this._selectedCol&&this._currentBoardData){var t=this.sudokuLogic.getValidCandidates(this._currentBoardData,this._selectedRow,this._selectedCol);null==(e=this.uiManager)||e.updateNumberPadState(t)}else{var n;null==(n=this.uiManager)||n.updateNumberPadState([])}},a.checkCompletionAfterUpdate=function(e,t){if(console.log("[InputManager] checkCompletionAfterUpdate: row="+e+", col="+t),this._currentBoardData){var n,a,o,l=Math.floor(e/u.BOX_SIZE)*u.BOX_SIZE+Math.floor(t/u.BOX_SIZE),s=!1;if(this.sudokuLogic.isPartComplete(this._currentBoardData,"row",e))console.log("[InputManager] Row "+e+" completed!"),null==(n=this.audioManager)||n.playSFX(u.AudioClipName.APPLAUSE),s=!0;if(this.sudokuLogic.isPartComplete(this._currentBoardData,"col",t))console.log("[InputManager] Column "+t+" completed!"),null==(a=this.audioManager)||a.playSFX(u.AudioClipName.APPLAUSE),s=!0;if(this.sudokuLogic.isPartComplete(this._currentBoardData,"box",l))console.log("[InputManager] Box "+l+" completed!"),null==(o=this.audioManager)||o.playSFX(u.AudioClipName.APPLAUSE),s=!0;s&&(console.log("[InputManager] Checking global completion..."),this.sudokuLogic.isBoardComplete(this._currentBoardData)&&(console.log("[InputManager] Board completed!"),this._isInputEnabled=!1,this.deselectCurrentCell(),i.emit(u.EventName.GAME_OVER,!0)))}},a.deselectCurrentCell=function(){var e;-1===this._selectedRow&&-1===this._selectedCol||(console.log("[InputManager] Deselecting cell."),this._selectedRow=-1,this._selectedCol=-1,null==(e=this.uiManager)||e.deselectCell(),this.updateNumberPadState())},a.onDestroy=function(){console.log("[InputManager] onDestroy"),i.off(u.EventName.CELL_CLICKED,this.onCellClicked,this),i.off(u.EventName.NUMBER_INPUT,this.onNumberInput,this),i.off(u.EventName.CLEAR_BUTTON_CLICKED,this.onClearButtonClicked,this),i.off(u.EventName.UNDO_BUTTON_CLICKED,this.onUndoButtonClicked,this),i.off(u.EventName.REDO_BUTTON_CLICKED,this.onRedoButtonClicked,this)},n}(r))||p);n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./GridCell.ts","./HistoryItem.ts","./HistoryPopupController.ts","./NumberButton.ts","./PopupBase.ts","./RankItem.ts","./RankingPopupController.ts","./SettingsPopupController.ts","./ActionRecord.ts","./GameData.ts","./SettingsData.ts","./UserData.ts","./SudokuLogic.ts","./AccountManager.ts","./AdManager.ts","./AudioManager.ts","./EffectsManager.ts","./GameManager.ts","./GridManager.ts","./InputManager.ts","./UIManager.ts","./CloudService.ts","./PersistenceManager.ts","./Constants.ts","./TimeFormatter.ts","./SudokuCore.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NumberButton.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,o,r,u,i,b,l,a,s,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){u=t.cclegacy,i=t._decorator,b=t.Label,l=t.Color,a=t.Button,s=t.find,m=t.Component}],execute:function(){var c,p,h,N,L,f,C;u._RF.push({},"2c986V5lOtJaLH4lBZLJukZ","NumberButton",void 0);var d=i.ccclass,g=i.property;t("NumberButton",(c=d("NumberButton"),p=g({type:b,tooltip:"显示数字的 Label 组件 (通常在按钮子节点上)"}),h=g({type:Number,tooltip:"此按钮代表的数字 (1-9)"}),c((f=e((L=function(t){function e(){for(var e,n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];return e=t.call.apply(t,[this].concat(u))||this,o(e,"numberLabel",f,r(e)),o(e,"buttonNumber",C,r(e)),e._buttonComponent=null,e.validNumberColor=l.RED,e.invalidNumberColor=l.GRAY,e.defaultNumberColor=l.BLACK,e}n(e,t);var u=e.prototype;return u.onLoad=function(){if(this._buttonComponent=this.getComponent(a),this._buttonComponent||console.log("[NumberButton] 节点 "+this.node.name+" 未找到 Button 组件。"),!this.numberLabel){var t=s("Label",this.node);t&&(this.numberLabel=t.getComponent(b))}this.numberLabel||console.warn("[NumberButton "+this.buttonNumber+"] 未能找到或链接 Label 组件用于显示数字。")},u.getNumber=function(){return this.buttonNumber},u.setNumber=function(t){this.numberLabel?(console.log("[NumberButton "+this.buttonNumber+"] 设置数字: "+t),this.numberLabel.string=t>0?t.toString():""):console.warn("[NumberButton "+this.buttonNumber+"] 未找到 Label 组件用于设置数字。")},u.setState=function(t){var e;this._buttonComponent&&(this._buttonComponent.interactable=t),e=t?this.validNumberColor:this.invalidNumberColor,this.numberLabel&&(this.numberLabel.color=e)},e}(m)).prototype,"numberLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(L.prototype,"buttonNumber",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),N=L))||N));u._RF.pop()}}}));

System.register("chunks:///_virtual/PersistenceManager.ts",["cc","./Constants.ts","./SettingsData.ts"],(function(e){var n,r,t;return{setters:[function(e){n=e.cclegacy},function(e){r=e.Constants},function(e){t=e.SettingsData}],execute:function(){n._RF.push({},"25f566AKvZLnqD/kJWFK28Y","PersistenceManager",void 0);e("PersistenceManager",function(){function e(){}return e.saveSettings=function(e){try{var n=JSON.stringify(e);wx.setStorageSync(r.StorageKeys.SETTINGS,n),console.log("[PersistenceManager] Settings saved.")}catch(e){console.error("[PersistenceManager] Error saving settings:",e)}},e.loadSettings=function(){try{var e=wx.getStorageSync(r.StorageKeys.SETTINGS);if(e&&"string"==typeof e){var n=JSON.parse(e),s=t.fromObject(n);return console.log("[PersistenceManager] Settings loaded:",s),s}return console.log("[PersistenceManager] No settings found in storage, returning defaults."),new t}catch(e){return console.error("[PersistenceManager] Error loading or parsing settings, returning defaults:",e),new t}},e.saveUnfinishedGame=function(e){try{var n=JSON.stringify(e);wx.setStorageSync(r.StorageKeys.UNFINISHED_GAME,n),console.log("[PersistenceManager] Unfinished game saved.")}catch(e){console.error("[PersistenceManager] Error saving unfinished game:",e)}},e.loadUnfinishedGame=function(){try{var e=wx.getStorageSync(r.StorageKeys.UNFINISHED_GAME);if(e&&"string"==typeof e){var n=JSON.parse(e);return n&&n.difficulty&&void 0!==n.levelIndex&&n.currentBoardState&&void 0!==n.elapsedTime?(console.log("[PersistenceManager] Unfinished game loaded."),n):(console.warn("[PersistenceManager] Loaded unfinished game data is invalid or incomplete."),this.clearUnfinishedGame(),null)}return console.log("[PersistenceManager] No unfinished game found in storage."),null}catch(e){return console.error("[PersistenceManager] Error loading or parsing unfinished game:",e),this.clearUnfinishedGame(),null}},e.clearUnfinishedGame=function(){try{wx.removeStorageSync(r.StorageKeys.UNFINISHED_GAME),console.log("[PersistenceManager] Unfinished game cleared from storage.")}catch(e){console.error("[PersistenceManager] Error clearing unfinished game:",e)}},e.hasSavedGame=function(){try{return wx.getStorageInfoSync().keys.includes(r.StorageKeys.UNFINISHED_GAME)}catch(e){return console.error("[PersistenceManager] Error checking for saved game:",e),!1}},e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/PopupBase.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var o,e,t,i,s,a,l,r,p,u,c,h,d,f;return{setters:[function(n){o=n.applyDecoratedDescriptor,e=n.inheritsLoose,t=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){s=n.cclegacy,a=n._decorator,l=n.Node,r=n.Button,p=n.BlockInputEvents,u=n.isValid,c=n.tween,h=n.Vec3,d=n.UIOpacity,f=n.Component}],execute:function(){var y,g,b,m,B,k,v,P,C,D,O,_,w;s._RF.push({},"c2f24fmfi9H56ESf494BLZB","PopupBase",void 0);var M=a.ccclass,E=a.property;n("PopupBase",(y=M("PopupBase"),g=E({type:l,tooltip:"弹窗背景遮罩节点"}),b=E({type:l,tooltip:"弹窗主面板节点"}),m=E({type:r,tooltip:"关闭按钮"}),B=E({type:Number,tooltip:"打开动画时长 (秒)"}),k=E({type:Number,tooltip:"关闭动画时长 (秒)"}),y((C=o((P=function(n){function o(){for(var o,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return o=n.call.apply(n,[this].concat(s))||this,t(o,"backgroundMask",C,i(o)),t(o,"panel",D,i(o)),t(o,"closeButton",O,i(o)),t(o,"openDuration",_,i(o)),t(o,"closeDuration",w,i(o)),o._uiManager=null,o._isOpen=!1,o}e(o,n);var s=o.prototype;return s.onLoad=function(){var n,o,e,t;this.backgroundMask&&!this.backgroundMask.getComponent(p)&&this.backgroundMask.addComponent(p),console.log("[PopupBase] 绑定背景遮罩点击事件: "+(null==(n=this.backgroundMask)?void 0:n.name)),null==(o=this.backgroundMask)||o.on(l.EventType.TOUCH_END,this.close,this),console.log("[PopupBase] 绑定关闭按钮事件: "+(null==(e=this.closeButton)?void 0:e.node.name)),null==(t=this.closeButton)||t.node.on(r.EventType.CLICK,this.close,this)},s.init=function(n){this._uiManager=n},s.show=function(){this._isOpen||(this._isOpen=!0,this.node.active=!0,this.onOpen.apply(this,arguments),this.playOpenAnimation(),console.log("[PopupBase] 显示弹窗: "+this.node.name))},s.close=function(){var n=this;this._isOpen&&(this._isOpen=!1,console.log("[PopupBase] 请求关闭弹窗: "+this.node.name),this.closeButton&&(this.closeButton.interactable=!1,this.closeButton.node.off(r.EventType.CLICK,this.close,this)),this.backgroundMask?this.backgroundMask.off(l.EventType.TOUCH_END,this.close,this):console.error("[PopupBase] 背景遮罩节点未设置: "+this.node.name),this.playCloseAnimation((function(){n.onClose(),u(n.node)&&(n.node.destroy(),console.log("[PopupBase] 弹窗已销毁: "+n.node.name))})))},s.playOpenAnimation=function(){this.panel&&(this.panel.setScale(.5,.5),c(this.panel).to(this.openDuration,{scale:new h(1,1,1)},{easing:"backOut"}).start());var n=this.node.getComponent(d)||this.node.addComponent(d);n.opacity=0,c(n).to(this.openDuration,{opacity:255}).start()},s.playCloseAnimation=function(n){var o=this,e=[];this.panel&&e.push(new Promise((function(n){c(o.panel).to(o.closeDuration,{scale:new h(.5,.5,1)},{easing:"backIn"}).call(n).start()})));var t=this.node.getComponent(d);t&&e.push(new Promise((function(n){c(t).to(o.closeDuration,{opacity:0}).call(n).start()}))),Promise.all(e).then((function(){n&&n()}))},s.onOpen=function(){console.log("[PopupBase] onOpen called for "+this.node.name)},s.onClose=function(){},s.onDestroy=function(){console.log("[PopupBase] onDestroy: "+this.node.name)},o}(f)).prototype,"backgroundMask",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=o(P.prototype,"panel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=o(P.prototype,"closeButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=o(P.prototype,"openDuration",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),w=o(P.prototype,"closeDuration",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),v=P))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/RankingPopupController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts"],(function(e){var n,o,r,t,i,l,a,u,c;return{setters:[function(e){n=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,a=e.Node,u=e.ScrollView},function(e){c=e.PopupBase}],execute:function(){var p,s,f,y,d,g,b,P,h;i._RF.push({},"2cdfdH3Q+JJC7tA7A0290qP","RankingPopupController",void 0);var R=l.ccclass,k=l.property;e("RankingPopupController",(p=R("RankingPopupController"),s=k(a),f=k(u),y=k(a),p((b=n((g=function(e){function n(){for(var n,o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return n=e.call.apply(e,[this].concat(i))||this,r(n,"myRankNode",b,t(n)),r(n,"scrollView",P,t(n)),r(n,"contentNode",h,t(n)),n}return o(n,e),n.prototype.onOpen=function(n){e.prototype.onOpen.call(this,n)},n}(c)).prototype,"myRankNode",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=n(g.prototype,"scrollView",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=n(g.prototype,"contentNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=g))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/RankItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,a,r,i,n,o,l,p,s,u,c,b,k,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){n=t.cclegacy,o=t._decorator,l=t.Label,p=t.Sprite,s=t.Color,u=t.assetManager,c=t.isValid,b=t.error,k=t.SpriteFrame,f=t.Component}],execute:function(){var h,m,v,y,g,L,R,d,S,C,I,A,_,w,z,D,F,E,B,H,M;n._RF.push({},"dfdedRO+0NJxIYLqHjU93ID","RankItem",void 0);var W=o.ccclass,x=o.property;t("RankItem",(h=W("RankItem"),m=x({type:l,tooltip:"显示排名的 Label"}),v=x({type:p,tooltip:"显示用户头像的 Sprite"}),y=x({type:l,tooltip:"显示用户昵称的 Label"}),g=x({type:l,tooltip:"显示分数的 Label"}),L=x({type:p,tooltip:"排名前三的特殊图标或背景 (可选)"}),R=x({type:s,tooltip:"第一名的颜色 (可选)"}),d=x({type:s,tooltip:"第二名的颜色 (可选)"}),S=x({type:s,tooltip:"第三名的颜色 (可选)"}),C=x({type:s,tooltip:"用户自己排名的背景色 (可选)"}),h((_=e((A=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,r(e,"rankLabel",_,i(e)),r(e,"avatarSprite",w,i(e)),r(e,"nicknameLabel",z,i(e)),r(e,"scoreLabel",D,i(e)),r(e,"topRankSprite",F,i(e)),r(e,"rank1Color",E,i(e)),r(e,"rank2Color",B,i(e)),r(e,"rank3Color",H,i(e)),r(e,"myRankBgColor",M,i(e)),e._rankData=null,e._isMyRank=!1,e._defaultAvatarFrame=null,e}a(e,t);var n=e.prototype;return n.setData=function(t,e,a){if(this._rankData=t,this._isMyRank=e,this._defaultAvatarFrame=null!=a?a:this._defaultAvatarFrame,!t)return console.log("[RankItem] 设置了空的排行数据。"),void(this.node.active=!1);this.node.active=!0,this.rankLabel&&(this.rankLabel.string=""+t.rank,this.rankLabel.color=s.WHITE,this.topRankSprite&&(this.topRankSprite.node.active=!1),1===t.rank?this.rankLabel.color=this.rank1Color:2===t.rank?this.rankLabel.color=this.rank2Color:3===t.rank&&(this.rankLabel.color=this.rank3Color)),this.nicknameLabel&&(this.nicknameLabel.string=t.nickname||"匿名用户"),this.scoreLabel&&(this.scoreLabel.string="通关: "+t.score),this.loadAvatar(t.avatarUrl);var r=this.getComponent(p);r&&(r.color=e?this.myRankBgColor:s.WHITE)},n.loadAvatar=function(t){var e=this;this.avatarSprite&&(t?u.loadRemote(t,{ext:".png"},(function(a,r){if(c(e.node)&&c(e.avatarSprite))if(a||!r)b("[RankItem] 加载头像失败: "+t,a),e.setDefaultAvatar();else{var i=k.createWithImage(r);e.avatarSprite.spriteFrame=i}else console.log("[RankItem] 加载头像完成时节点或 Sprite 已销毁。")})):this.setDefaultAvatar())},n.setDefaultAvatar=function(){this.avatarSprite&&(this._defaultAvatarFrame?this.avatarSprite.spriteFrame=this._defaultAvatarFrame:(this.avatarSprite.spriteFrame=null,this.avatarSprite.color=s.GRAY,warn("[RankItem] 未能设置默认头像。")))},e}(f)).prototype,"rankLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(A.prototype,"avatarSprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(A.prototype,"nicknameLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(A.prototype,"scoreLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(A.prototype,"topRankSprite",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(A.prototype,"rank1Color",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.RED}}),B=e(A.prototype,"rank2Color",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.ORANGE}}),H=e(A.prototype,"rank3Color",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.YELLOW}}),M=e(A.prototype,"myRankBgColor",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new s(200,230,255)}}),I=A))||I));n._RF.pop()}}}));

System.register("chunks:///_virtual/SettingsData.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"3caee+VVkxMTbu2kdreYUAU","SettingsData",void 0);e("SettingsData",function(){function e(e,n){void 0===e&&(e=!0),void 0===n&&(n=!0),this.bgmEnabled=void 0,this.sfxEnabled=void 0,this.bgmEnabled=e,this.sfxEnabled=n}return e.fromObject=function(n){var t=new e;return n&&("boolean"==typeof n.bgmEnabled&&(t.bgmEnabled=n.bgmEnabled),"boolean"==typeof n.sfxEnabled&&(t.sfxEnabled=n.sfxEnabled)),t},e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/SettingsPopupController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./Constants.ts"],(function(e){var o,t,n,g,i,s,l,r,h,a;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,g=e.assertThisInitialized},function(e){i=e.cclegacy,s=e._decorator,l=e.Toggle,r=e.director},function(e){h=e.PopupBase},function(e){a=e.Constants}],execute:function(){var p,c,f,u,T,d,m;i._RF.push({},"ef939S5qqZPm7MRngyJVMPX","SettingsPopupController",void 0);var C=s.ccclass,b=s.property;e("SettingsPopupController",(p=C("SettingsPopupController"),c=b(l),f=b(l),p((d=o((T=function(e){function o(){for(var o,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return o=e.call.apply(e,[this].concat(i))||this,n(o,"bgmToggle",d,g(o)),n(o,"sfxToggle",m,g(o)),o}t(o,e);var i=o.prototype;return i.onOpen=function(o){e.prototype.onOpen.call(this,o),console.log("[SettingsPopupController] onOpen: "+this.node.name+", initialSettings: "+JSON.stringify(o)+" "+this.bgmToggle+" "+this.sfxToggle),o&&this.bgmToggle&&(this.bgmToggle.isChecked=o.bgmEnabled),o&&this.sfxToggle&&(this.sfxToggle.isChecked=o.sfxEnabled),this.bgmToggle&&this.bgmToggle.node&&this.bgmToggle.node.on("toggle",this.onBgmToggleChanged,this),this.sfxToggle&&this.sfxToggle.node&&this.sfxToggle.node.on("toggle",this.onSfxToggleChanged,this)},i.onBgmToggleChanged=function(e){r.emit(a.EventName.SETTINGS_BGM_CHANGED,e.isChecked)},i.onSfxToggleChanged=function(e){r.emit(a.EventName.SETTINGS_SFX_CHANGED,e.isChecked)},i.onClose=function(){this.bgmToggle&&this.bgmToggle.node?this.bgmToggle.node.off("toggle",this.onBgmToggleChanged,this):console.error("BgmToggle is not set in SettingsPopupController!"),this.sfxToggle&&this.sfxToggle.node?this.sfxToggle.node.off("toggle",this.onSfxToggleChanged,this):console.error("SfxToggle is not set in SettingsPopupController!"),e.prototype.onClose.call(this)},o}(h)).prototype,"bgmToggle",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=o(T.prototype,"sfxToggle",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=T))||u));i._RF.pop()}}}));

System.register("chunks:///_virtual/SudokuCore.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var t,e;return{setters:[function(r){t=r.createForOfIteratorHelperLoose},function(r){e=r.cclegacy}],execute:function(){e._RF.push({},"4a6fegPWqZOu6oCTu6Iu6qx","SudokuCore",void 0);var i=r("default",function(){function r(){this.COLS=r.DIGITS,this.SQUARES=null,this.UNITS=null,this.SQUARE_UNITS_MAP=null,this.SQUARE_PEERS_MAP=null,this.MIN_GIVENS=17,this.NR_SQUARES=81,this.BLANK_CHAR=".",this.BLANK_BOARD="................................................................................."}var e=r.prototype;return e.initialize=function(){console.log("sudoku initialize"),this.SQUARES=this._cross(r.ROWS,this.COLS),this.UNITS=this._get_all_units(r.ROWS,this.COLS),this.SQUARE_UNITS_MAP=this._get_square_units_map(this.SQUARES,this.UNITS),this.SQUARE_PEERS_MAP=this._get_square_peers_map(this.SQUARES,this.SQUARE_UNITS_MAP)},e.generate=function(e,i){if(!this.SQUARES)throw new Error("SudokuCore not initialized. Call initialize() first.");var n;n="string"==typeof e?r.DIFFICULTY[e]||r.DIFFICULTY.easy:"number"==typeof e?e:r.DIFFICULTY.easy,n=this._force_range(n,this.NR_SQUARES,this.MIN_GIVENS),n=this._force_range(n,this.NR_SQUARES+1,this.MIN_GIVENS);var a=this._get_candidates_map(this.BLANK_BOARD);if(!a)return console.error("Failed to get initial candidates for a blank board."),this.generate(e,i);for(var o,s=this._shuffle(this.SQUARES),u=t(s);!(o=u()).done;){var h=o.value,l=a[h];if(!l||0===l.length)break;var _=l[this._rand_range(l.length)],f=this._assign(a,h,_);if(!f)break;a=f;for(var v,S=[],d=t(this.SQUARES);!(v=d()).done;){var c=v.value;1===a[c].length&&S.push(a[c])}if(S.length>=n&&this._strip_dups(S).length>=8){for(var g="",A=[],E=0;E<this.SQUARES.length;E++){var R=this.SQUARES[E];1===a[R].length?(g+=a[R],A.push(E)):g+=this.BLANK_CHAR}var U=A.length;if(U>n){for(var p=this._shuffle(A),I=g.split(""),Q=0;Q<U-n;++Q){I[p[Q]]=this.BLANK_CHAR}g=I.join("")}if(this.solve(g))return g}}return this.generate(e,i)},e.solve=function(e,i){if(void 0===i&&(i=!1),!this.SQUARES||!this.SQUARE_PEERS_MAP||!this.SQUARE_UNITS_MAP)throw new Error("SudokuCore not initialized. Call initialize() first.");var n=this.validate_board(e);if(!0!==n)throw new Error(n);for(var a,o=0,s=t(e);!(a=s()).done;){var u=a.value;u!==this.BLANK_CHAR&&this._in(u,r.DIGITS)&&++o}if(o<this.MIN_GIVENS)throw new Error("Too few givens. Minimum givens is "+this.MIN_GIVENS);var h=this._get_candidates_map(e);if(!h)return!1;var l=this._search(h,i);if(console.log("Search result:",l),l){for(var _,f="",v=t(this.SQUARES);!(_=v()).done;){f+=l[_.value]}return f}return!1},e.get_candidates=function(r){if(!this.SQUARES)throw new Error("SudokuCore not initialized. Call initialize() first.");var e=this.validate_board(r);if(!0!==e)throw new Error(e);var i=this._get_candidates_map(r);if(!i)return null;for(var n,a=[],o=[],s=0,u=t(this.SQUARES);!(n=u()).done;){var h=i[n.value];o.push(h),s%9==8&&(a.push(o),o=[]),++s}return a},e._get_candidates_map=function(e){if(!this.SQUARES)return console.error("_get_candidates_map called before initialization."),!1;var i=this.validate_board(e);if(!0!==i)return console.error("Invalid board passed to _get_candidates_map:",i),!1;for(var n,a={},o=this._get_square_vals_map(e),s=t(this.SQUARES);!(n=s()).done;){a[n.value]=r.DIGITS}for(var u in o){var h=o[u];if(this._in(h,r.DIGITS))if(!this._assign(a,u,h))return!1}return a},e._search=function(r,e){if(void 0===e&&(e=!1),!this.SQUARES)return console.error("_search called before initialization."),!1;if(!r)return!1;for(var i,n=!0,a=t(this.SQUARES);!(i=a()).done;){1!==r[i.value].length&&(n=!1)}if(n)return console.log("Solved!"),r;for(var o,s=10,u=null,h=t(this.SQUARES);!(o=h()).done;){var l=o.value,_=r[l].length;_<s&&_>1&&(s=_,u=l)}if(null===u)return!1;for(var f,v=r[u],S=e?v.split("").reverse():v.split(""),d=t(S);!(f=d()).done;){var c=f.value,g=JSON.parse(JSON.stringify(r)),A=this._assign(g,u,c),E=this._search(A,e);if(E)return E}return!1},e._assign=function(r,e,i){for(var n,a=r[e].replace(i,""),o=t(a);!(n=o()).done;){var s=n.value;if(!this._eliminate(r,e,s))return!1}return r},e._eliminate=function(r,e,i){if(!this.SQUARE_PEERS_MAP||!this.SQUARE_UNITS_MAP)return console.error("_eliminate called before initialization."),!1;if(!this._in(i,r[e]))return r;r[e]=r[e].replace(i,"");var n=r[e].length;if(0===n)return!1;if(1===n){var a=r[e],o=this.SQUARE_PEERS_MAP[e];if(!o)return!1;for(var s,u=t(o);!(s=u()).done;){var h=s.value;if(!this._eliminate(r,h,a))return!1}}var l=this.SQUARE_UNITS_MAP[e];if(!l)return!1;for(var _,f=t(l);!(_=f()).done;){for(var v,S=_.value,d=[],c=t(S);!(v=c()).done;){var g=v.value;this._in(i,r[g])&&d.push(g)}if(0===d.length)return!1;if(1===d.length){var A=d[0];if(!this._assign(r,A,i))return!1}}return r},e._get_square_vals_map=function(r){if(!this.SQUARES)throw new Error("SudokuCore not initialized. Call initialize() first.");var t={};if(r.length!==this.NR_SQUARES)throw new Error("Board/squares length mismatch.");for(var e=0;e<this.SQUARES.length;++e)t[this.SQUARES[e]]=r[e];return t},e._get_square_units_map=function(r,e){for(var i,n={},a=t(r);!(i=a()).done;){for(var o,s=i.value,u=[],h=t(e);!(o=h()).done;){var l=o.value;l.includes(s)&&u.push(l)}n[s]=u}return n},e._get_square_peers_map=function(r,e){for(var i,n={},a=t(r);!(i=a()).done;){var o=i.value,s=e[o];if(s){for(var u,h=new Set,l=t(s);!(u=l()).done;)for(var _,f=u.value,v=t(f);!(_=v()).done;){var S=_.value;S!==o&&h.add(S)}n[o]=Array.from(h)}}return n},e._get_all_units=function(r,e){for(var i,n=[],a=t(r);!(i=a()).done;){var o=i.value;n.push(this._cross(o,e))}for(var s,u=t(e);!(s=u()).done;){var h=s.value;n.push(this._cross(r,h))}for(var l=["123","456","789"],_=0,f=["ABC","DEF","GHI"];_<f.length;_++)for(var v,S=f[_],d=t(l);!(v=d()).done;){var c=v.value;n.push(this._cross(S,c))}return n},e.board_string_to_grid=function(r){for(var t=[],e=[],i=0;i<r.length;i++)e.push(r[i]),i%9==8&&(t.push(e),e=[]);return t},e.board_grid_to_string=function(r){for(var t="",e=0;e<9;++e)for(var i=0;i<9;++i)r[e]&&void 0!==r[e][i]?t+=r[e][i]:(console.warn("Malformed grid at row "+e+", col "+i+". Appending blank."),t+=this.BLANK_CHAR);return t.length!==this.NR_SQUARES&&console.error("Resulting string length "+t.length+" does not match expected "+this.NR_SQUARES),t},e.print_board=function(r){var t=this.validate_board(r);if(!0!==t)throw new Error(t);for(var e="",i=0;i<r.length;i++){e+=r[i]+" ",i%9!=2&&i%9!=5||(e+="  "),i%9==8&&(e+="\n",26!==i&&53!==i||(e+="\n"))}console.log(e)},e.validate_board=function(t){if(!t)return"Empty board";if(t.length!==this.NR_SQUARES)return"Invalid board size. Board must be exactly "+this.NR_SQUARES+" squares.";for(var e=0;e<t.length;e++){var i=t[e];if(!this._in(i,r.DIGITS)&&i!==this.BLANK_CHAR)return"Invalid board character encountered at index "+e+": "+i}return!0},e._cross=function(r,e){for(var i,n=[],a=t(r);!(i=a()).done;)for(var o,s=i.value,u=t(e);!(o=u()).done;){var h=o.value;n.push(s+h)}return n},e._in=function(r,t){return-1!==t.indexOf(r)},e.first_true=function(r){for(var e,i=t(r);!(e=i()).done;){var n=e.value;if(n)return n}return!1},e._shuffle=function(r){for(var t=[].concat(r),e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t},e._rand_range=function(r,t){if(void 0===t&&(t=0),r<=t){if(r<t)throw new Error("_rand_range: max ("+r+") cannot be less than min ("+t+")");return t}return Math.floor(Math.random()*(r-t))+t},e._strip_dups=function(r){return Array.from(new Set(r))},e._force_range=function(r,t,e){void 0===e&&(e=0);var i=null==r?0:r;return i<e?e:i>=t?t-1:i},r}());i.DIGITS="123456789",i.ROWS="ABCDEFGHI",i.DIFFICULTY={easy:62,medium:53,hard:44,"very-hard":35,insane:26,inhuman:17},e._RF.pop()}}}));

System.register("chunks:///_virtual/SudokuLogic.ts",["cc","./Constants.ts","./GameData.ts","./SudokuCore.ts"],(function(r){var o,t,e,i;return{setters:[function(r){o=r.cclegacy},function(r){t=r.Constants},function(r){e=r.createEmptyBoardData},function(r){i=r.default}],execute:function(){o._RF.push({},"d53bbJKwQRLWYNNrit+cMEX","SudokuLogic",void 0),r("SudokuLogic",function(){function r(){this.core=void 0,this.core=new i,this.core.initialize(),console.log("[SudokuLogic] SudokuCore initialized.")}r.getInstance=function(){return r.instance||(r.instance=new r),r.instance};var o=r.prototype;return o.convertStringToBoardData=function(r,o){var i=e();if(r.length!==t.GRID_SIZE*t.GRID_SIZE)return console.error("[SudokuLogic] Invalid board string length for conversion:",r),i;for(var n=0;n<t.GRID_SIZE;n++)for(var a=0;a<t.GRID_SIZE;a++){var u=r[n*t.GRID_SIZE+a];u>="1"&&u<="9"?(i.grid[n][a]=parseInt(u,10),i.presetMask[n][a]=!0):(i.grid[n][a]=0,i.presetMask[n][a]=!1)}if(o&&o.length===t.GRID_SIZE*t.GRID_SIZE){i.solution=e().grid;for(var l=0;l<t.GRID_SIZE;l++)for(var s=0;s<t.GRID_SIZE;s++){var c=o[l*t.GRID_SIZE+s];i.solution[l][s]=c>="1"&&c<="9"?parseInt(c,10):0}}return i},o.convertBoardDataToString=function(r){for(var o="",e=0;e<t.GRID_SIZE;e++)for(var i=0;i<t.GRID_SIZE;i++){var n=r.grid[e][i];o+=n>=1&&n<=9?n.toString():this.core.BLANK_CHAR}return o},o.generateSudoku=function(r,o){console.log("[SudokuLogic] Generating puzzle for difficulty: "+r+", level: "+o);var e=null;for(var i in t.Difficulty){var n=i;if(t.Difficulty[n]===r){e=n;break}}if(!e)return console.error('[SudokuLogic] 无法找到难度 "'+r+'" 对应的内部 Key。'),null;var a=t.DifficultyEmptyCells[e];if(!a)return console.error("[SudokuLogic] Invalid difficulty provided: "+e),null;var u=Math.round(a.start+(a.end-a.start)/(t.LEVELS_PER_DIFFICULTY-1)*(o-1)),l=t.GRID_SIZE*t.GRID_SIZE-u;l=Math.max(this.core.MIN_GIVENS,Math.min(80,l)),console.log("[SudokuLogic] Target empty cells: "+u+", Target givens: "+l);try{var s=this.core.generate(l);if(!s||81!==s.length)return console.error("[SudokuLogic] Failed to generate valid board string from core library."),null;console.log("[SudokuLogic] Board string generated:",s);var c=this.core.solve(s);c||console.warn("[SudokuLogic] Generated board might not have a unique solution or solver failed. Proceeding without solution.");var I=this.convertStringToBoardData(s,c||void 0);return console.log("[SudokuLogic] Puzzle generated successfully."),I}catch(r){return console.error("[SudokuLogic] Error during puzzle generation:",r),null}},o.isValidMove=function(r,o,e,i){if(i<1||i>9||o<0||o>=t.GRID_SIZE||e<0||e>=t.GRID_SIZE)return!1;for(var n=0;n<t.GRID_SIZE;n++)if(r.grid[o][n]===i&&n!==e)return!1;for(var a=0;a<t.GRID_SIZE;a++)if(r.grid[a][e]===i&&a!==o)return!1;for(var u=Math.floor(o/t.BOX_SIZE)*t.BOX_SIZE,l=Math.floor(e/t.BOX_SIZE)*t.BOX_SIZE,s=u;s<u+t.BOX_SIZE;s++)for(var c=l;c<l+t.BOX_SIZE;c++)if(r.grid[s][c]===i&&(s!==o||c!==e))return!1;return!0},o.isPartComplete=function(r,o,e){var i=new Set,n=0;if("row"===o){if(e<0||e>=t.GRID_SIZE)return!1;for(var a=0;a<t.GRID_SIZE;a++){var u=r.grid[e][a];if(u>0){if(i.has(u))return!1;i.add(u),n++}}}else if("col"===o){if(e<0||e>=t.GRID_SIZE)return!1;for(var l=0;l<t.GRID_SIZE;l++){var s=r.grid[l][e];if(s>0){if(i.has(s))return!1;i.add(s),n++}}}else{if("box"!==o)return!1;if(e<0||e>=t.GRID_SIZE)return!1;for(var c=Math.floor(e/t.BOX_SIZE)*t.BOX_SIZE,I=e%t.BOX_SIZE*t.BOX_SIZE,f=c;f<c+t.BOX_SIZE;f++)for(var d=I;d<I+t.BOX_SIZE;d++){var S=r.grid[f][d];if(S>0){if(i.has(S))return!1;i.add(S),n++}}}return n===t.GRID_SIZE&&i.size===t.GRID_SIZE},o.isBoardComplete=function(r){for(var o=0;o<t.GRID_SIZE;o++){if(!this.isPartComplete(r,"row",o))return!1;if(!this.isPartComplete(r,"col",o))return!1;if(!this.isPartComplete(r,"box",o))return!1}return!0},o.getValidCandidates=function(r,o,e){if(o<0||o>=t.GRID_SIZE||e<0||e>=t.GRID_SIZE||0!==r.grid[o][e])return[];for(var i=[],n=1;n<=9;n++)this.isValidMove(r,o,e,n)&&i.push(n);return i},o.solveSudoku=function(r){try{var o=this.convertBoardDataToString(r),i=this.core.solve(o);if(i){for(var n=e(),a=0;a<t.GRID_SIZE;a++)for(var u=0;u<t.GRID_SIZE;u++){var l=a*t.GRID_SIZE+u;n.grid[a][u]=parseInt(i[l],10)}return n}return null}catch(r){return console.error("[SudokuLogic] Error during solving:",r),null}},r}()).instance=null,o._RF.pop()}}}));

System.register("chunks:///_virtual/TimeFormatter.ts",["cc"],(function(t){var r;return{setters:[function(t){r=t.cclegacy}],execute:function(){r._RF.push({},"87107fXaUFO556JFIpSBavS","TimeFormatter",void 0);t("TimeFormatter",function(){function t(){}return t.formatSeconds=function(t){(isNaN(t)||t<0)&&(t=0);var r=Math.floor(t),o=r%60;return Math.floor(r/60).toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")},t.formatSecondsWithHours=function(t){(isNaN(t)||t<0)&&(t=0);var r=Math.floor(t),o=Math.floor(r/3600),a=Math.floor(r%3600/60),n=r%60;return o.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")},t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Constants.ts","./NumberButton.ts","./PersistenceManager.ts","./SettingsPopupController.ts","./HistoryPopupController.ts","./RankingPopupController.ts"],(function(e){var t,n,o,i,a,r,l,u,s,c,p,g,m,d,f,h,b,y,C,v,I,N,B,U,M,P,S,E,L;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator},function(e){r=e.cclegacy,l=e._decorator,u=e.Label,s=e.Button,c=e.Sprite,p=e.Node,g=e.Prefab,m=e.warn,d=e.error,f=e.director,h=e.UIOpacity,b=e.isValid,y=e.SpriteFrame,C=e.instantiate,v=e.tween,I=e.Vec3,N=e.Component,B=e.resources},function(e){U=e.Constants},function(e){M=e.NumberButton},function(e){P=e.PersistenceManager},function(e){S=e.SettingsPopupController},function(e){E=e.HistoryPopupController},function(e){L=e.RankingPopupController}],execute:function(){var _,w,T,F,k,R,D,A,z,O,K,x,H,G,V,W,Y,j,q,J,Q,X,Z,$,ee,te,ne,oe,ie,ae,re,le,ue,se,ce,pe,ge,me,de,fe,he,be,ye,Ce,ve,Ie,Ne,Be,Ue,Me,Pe,Se,Ee;r._RF.push({},"1fc56ggYntCtazMrgBSowoz","UIManager",void 0);var Le=l.ccclass,_e=l.property;e("UIManager",(_=Le("UIManager"),w=_e({type:u,tooltip:"显示计时器的 Label 组件"}),T=_e({type:s,tooltip:"暂停/恢复按钮"}),F=_e({type:c,tooltip:"暂停/恢复按钮的图标 Sprite"}),k=_e({type:s,tooltip:"设置按钮"}),R=_e({type:p,tooltip:"棋盘容器节点 (GridManager 挂载点)"}),D=_e({type:p,tooltip:"难度选择按钮的容器节点"}),A=_e({type:s,tooltip:"入门难度按钮"}),z=_e({type:s,tooltip:"初级难度按钮"}),O=_e({type:s,tooltip:"中级难度按钮"}),K=_e({type:s,tooltip:"高级难度按钮"}),x=_e({type:s,tooltip:"大师级难度按钮"}),H=_e({type:p,tooltip:"数字输入按钮 (1-9) 的容器节点"}),G=_e({type:s,tooltip:"清除按钮"}),V=_e({type:s,tooltip:"撤销按钮"}),W=_e({type:s,tooltip:"恢复按钮"}),Y=_e({type:g,tooltip:"设置弹窗预制件"}),j=_e({type:g,tooltip:"关卡记录弹窗预制件"}),q=_e({type:g,tooltip:"排行榜弹窗预制件"}),J=_e({type:g,tooltip:"关卡记录列表项预制件"}),Q=_e({type:g,tooltip:"排行榜列表项预制件"}),X=_e({type:p,tooltip:"广告遮罩层节点"}),Z=_e({type:p,tooltip:"广告实际挂载的容器节点 (在遮罩层内)"}),$=_e({type:p,tooltip:"底部导航栏容器 (可选)"}),ee=_e({type:s,tooltip:"显示记录按钮 (可选)"}),te=_e({type:s,tooltip:"显示排行按钮 (可选)"}),_((ie=t((oe=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,o(t,"timerLabel",ie,i(t)),o(t,"pauseResumeButton",ae,i(t)),o(t,"pauseResumeIcon",re,i(t)),o(t,"settingsButton",le,i(t)),o(t,"gameBoardNode",ue,i(t)),o(t,"difficultySelectorNode",se,i(t)),o(t,"entryButton",ce,i(t)),o(t,"easyButton",pe,i(t)),o(t,"mediumButton",ge,i(t)),o(t,"hardButton",me,i(t)),o(t,"masterButton",de,i(t)),o(t,"numberPadNode",fe,i(t)),t._numberButtonComponents=new Map,o(t,"clearButton",he,i(t)),o(t,"undoButton",be,i(t)),o(t,"redoButton",ye,i(t)),o(t,"settingsPopupPrefab",Ce,i(t)),o(t,"historyPopupPrefab",ve,i(t)),o(t,"rankingPopupPrefab",Ie,i(t)),o(t,"recordItemPrefab",Ne,i(t)),o(t,"rankItemPrefab",Be,i(t)),o(t,"adOverlayNode",Ue,i(t)),o(t,"adContainerNode",Me,i(t)),o(t,"bottomNavBarNode",Pe,i(t)),o(t,"historyNavButton",Se,i(t)),o(t,"rankingNavButton",Ee,i(t)),t._isInitialized=!1,t._activePopups=[],t.loadedSpriteFrames=new Map,t.loadedNumberFrames=new Map,t.loadedIconFrames=new Map,t.gridManager=null,t.effectsManager=null,t}n(t,e);var r=t.prototype;return r.initialize=function(e,t){this._isInitialized?m("[UIManager] UIManager 已初始化，跳过。"):(console.log("[UIManager] Initializing..."),this.gridManager=e,this.effectsManager=t,this.gridManager&&this.effectsManager?(this.cacheNumberButtons(),this.bindButtonEvents(),this.setupInitialUIState(),this._isInitialized=!0,console.log("[UIManager] 初始化成功。")):d("[UIManager] 初始化失败: 缺少必要的管理器实例。"))},r.cacheNumberButtons=function(){var e=this;console.log("[UIManager] 缓存数字按钮..."),this.numberPadNode?(this._numberButtonComponents.clear(),this.numberPadNode.getComponentsInChildren(M).forEach((function(t){console.log("[UIManager] 缓存了数字按钮 "+t.getNumber()+" 的 NumberButton 组件。"),t.setState(!1),e._numberButtonComponents.set(t.getNumber(),t)}))):console.warn("[UIManager] NumberPadNode 未在编辑器中设置。")},r.setupInitialUIState=function(){console.log("[UIManager] 设置初始 UI 状态..."),this.adOverlayNode?this.adOverlayNode.active=!1:console.warn("[UIManager] AdOverlayNode 未在编辑器中设置，无法设置初始状态。"),this._activePopups=[],console.log("[UIManager] 初始 UI 状态设置完成。")},r.preloadAssets=function(){var e=a((function*(){var e,t=this;console.log("[UIManager] Preloading UI assets...");var n=[],o=((e={})[U.SpriteFrameName.CELL_PRESET_BG]="textures/game/"+U.SpriteFrameName.CELL_PRESET_BG+"/spriteFrame",e[U.SpriteFrameName.CELL_USER_BG]="textures/game/"+U.SpriteFrameName.CELL_USER_BG+"/spriteFrame",e[U.IconName.PAUSE]="textures/ui/"+U.IconName.PAUSE+"/spriteFrame",e[U.IconName.RESUME]="textures/ui/"+U.IconName.RESUME+"/spriteFrame",e[U.SpriteFrameName.DEFAULT_AVATAR]="textures/ui/"+U.SpriteFrameName.DEFAULT_AVATAR+"/spriteFrame",e),i=function*(e){var i=o[e];n.push(new Promise((function(n){B.load(i,y,(function(o,a){o||!a?console.error("[UIManager] 加载 SpriteFrame 失败: "+i,o):(t.loadedSpriteFrames.set(e,a),e===U.SpriteFrameName.NUM_BTN_VALID_BG?t._validNumPadFrame=a:e===U.SpriteFrameName.NUM_BTN_INVALID_BG&&(t._invalidNumPadFrame=a)),n(null)}))})))};for(var a in o)yield*i(a);for(var r=function*(){var e=u[l],o="textures/game/numbers/"+e+"/spriteFrame";n.push(new Promise((function(n){B.load(o,y,(function(i,a){i||!a?console.error("[UIManager] 加载数字 SpriteFrame 失败: "+o,i):t.loadedNumberFrames.set(e,a),n(null)}))})))},l=0,u=[1,2,3,4,5,6,7,8,9];l<u.length;l++)yield*r();yield Promise.all(n),console.log("[UIManager] UI assets preloaded.")}));return function(){return e.apply(this,arguments)}}(),r.getSpriteFrame=function(e){return this.loadedSpriteFrames.get(e)||null},r.getNumberSpriteFrame=function(e){return this.loadedNumberFrames.get(e)||null},r.getIconFrame=function(e){return this.loadedIconFrames.get(e)||null},r.bindButtonEvents=function(){var e,t,n,o,i,a,r,l,u,c,p,g,m=this;console.log("[UIManager] Binding button events..."),null==(e=this.pauseResumeButton)||e.node.on(s.EventType.CLICK,this.onPauseResumeClick,this),null==(t=this.settingsButton)||t.node.on(s.EventType.CLICK,this.onSettingsClick,this),null==(n=this.entryButton)||n.node.on(s.EventType.CLICK,(function(){return m.onDifficultySelect(U.Difficulty.ENTRY)}),this),null==(o=this.easyButton)||o.node.on(s.EventType.CLICK,(function(){return m.onDifficultySelect(U.Difficulty.EASY)}),this),null==(i=this.mediumButton)||i.node.on(s.EventType.CLICK,(function(){return m.onDifficultySelect(U.Difficulty.MEDIUM)}),this),null==(a=this.hardButton)||a.node.on(s.EventType.CLICK,(function(){return m.onDifficultySelect(U.Difficulty.HARD)}),this),null==(r=this.masterButton)||r.node.on(s.EventType.CLICK,(function(){return m.onDifficultySelect(U.Difficulty.MASTER)}),this),this._numberButtonComponents.forEach((function(e,t){var n=e.getComponent(s);null==n||n.node.on(s.EventType.CLICK,(function(){return m.onNumberPadClick(t)}),m)})),null==(l=this.clearButton)||l.node.on(s.EventType.CLICK,this.onClearClick,this),null==(u=this.undoButton)||u.node.on(s.EventType.CLICK,this.onUndoClick,this),null==(c=this.redoButton)||c.node.on(s.EventType.CLICK,this.onRedoClick,this),null==(p=this.historyNavButton)||p.node.on(s.EventType.CLICK,this.onHistoryNavClick,this),null==(g=this.rankingNavButton)||g.node.on(s.EventType.CLICK,this.onRankingNavClick,this)},r.onPauseResumeClick=function(){console.log("[UIManager] Pause/Resume button clicked."),f.emit(U.EventName.PAUSE_RESUME_BUTTON_CLICKED)},r.onSettingsClick=function(){console.log("[UIManager] Settings button clicked."),f.emit(U.EventName.SETTINGS_BUTTON_CLICKED),this.showSettingsPopup(P.loadSettings())},r.onDifficultySelect=function(e){console.log("[UIManager] Difficulty selected: "+e),f.emit(U.EventName.DIFFICULTY_SELECTED,e)},r.onNumberPadClick=function(e){f.emit(U.EventName.NUMBER_INPUT,e)},r.onClearClick=function(){console.log("[UIManager] Clear button clicked."),f.emit(U.EventName.CLEAR_BUTTON_CLICKED)},r.onUndoClick=function(){console.log("[UIManager] Undo button clicked."),f.emit(U.EventName.UNDO_BUTTON_CLICKED)},r.onRedoClick=function(){console.log("[UIManager] Redo button clicked."),f.emit(U.EventName.REDO_BUTTON_CLICKED)},r.onHistoryNavClick=function(){console.log("[UIManager] History nav button clicked."),f.emit(U.EventName.SHOW_HISTORY_CLICKED)},r.onRankingNavClick=function(){console.log("[UIManager] Ranking nav button clicked."),f.emit(U.EventName.SHOW_RANKING_CLICKED)},r.updateTimer=function(e){if(this.timerLabel){var t=e%60,n=Math.floor(e/60).toString().padStart(2,"0")+":"+t.toString().padStart(2,"0");this.timerLabel.string=n}},r.updatePauseResumeButton=function(e){if(this.pauseResumeIcon){var t=e?U.IconName.RESUME:U.IconName.PAUSE,n=this.getIconFrame(t);n?this.pauseResumeIcon.spriteFrame=n:m("[UIManager] 图标 SpriteFrame 未找到: "+t)}},r.updateUndoRedoButtons=function(e,t){if(this.undoButton&&(this.undoButton.interactable=e),this.redoButton&&(this.redoButton.interactable=t),this.undoButton){var n,o=null==(n=this.undoButton)?void 0:n.node.getComponent(h);o&&(o.opacity=e?255:128)}if(this.redoButton){var i=this.redoButton.node.getComponent(h);i&&(i.opacity=t?255:128)}},r.updateNumberPadState=function(e){var t=new Set(e),n=e.length>0;this._numberButtonComponents.forEach((function(e,o){var i=n&&t.has(o);e.setState(i)}))},r.highlightCell=function(e,t){var n;null==(n=this.gridManager)||n.highlightCell(e,t)},r.deselectCell=function(){var e;null==(e=this.gridManager)||e.deselectCell()},r.playInputAnimation=function(e,t,n,o){var i,a,r;console.log("[UIManager] 播放数字输入动画: ("+e+", "+t+") -> "+n),null==(i=this.gridManager)||i.updateCellDisplay(e,t,n,!1),null==(a=this.effectsManager)||a.animateNumberAppear(null==(r=this.gridManager)?void 0:r.getCellNode(e,t),o)},r.playClearAnimation=function(e,t,n){var o,i,a;console.log("[UIManager] 播放数字消失动画: ("+e+", "+t+")"),null==(o=this.gridManager)||o.updateCellDisplay(e,t,0,!1),null==(i=this.effectsManager)||i.animateNumberDisappear(null==(a=this.gridManager)?void 0:a.getCellNode(e,t),n)},r.showWinAnimation=function(){var e;console.log("[UIManager] 播放胜利动画。this node is: ",this.node.name),null==(e=this.effectsManager)||e.playWinEffect(this.node)},r.showDifficultySelection=function(){console.log("[UIManager] 显示难度选择界面。"),this.deselectCell(),this.closeAllPopups()},r.showSettingsPopup=function(e){var t=this;console.log("[UIManager] 准备显示设置弹窗。"),this.showPopup(this.settingsPopupPrefab,(function(n){var o=n.getComponent(S);null==o||o.init(t),null==o||o.show(e)}))},r.showHistoryPopup=function(e){var t=this;this.showPopup(this.historyPopupPrefab,(function(n){var o=n.getComponent(E);null==o||o.init(t),null==o||o.show(e)}))},r.populateRecordItem=function(e,t){var n,o,i,a,r,l=this,c=null==(n=e.getChildByName("DifficultyLabel"))?void 0:n.getComponent(u),p=null==(o=e.getChildByName("LevelLabel"))?void 0:o.getComponent(u),g=null==(i=e.getChildByName("BestTimeLabel"))?void 0:i.getComponent(u),m=null==(a=e.getChildByName("DateLabel"))?void 0:a.getComponent(u),d=null==(r=e.getChildByName("ChallengeButton"))?void 0:r.getComponent(s);if(c&&(c.string=t.difficulty),p&&(p.string="第 "+t.levelIndex+" 关"),g){var h=Math.floor(t.bestTimeSeconds/60),b=t.bestTimeSeconds%60;g.string="最佳: "+h.toString().padStart(2,"0")+":"+b.toString().padStart(2,"0")}if(m){var y=new Date(t.firstCompletionTimestamp);m.string="完成于: "+y.toLocaleDateString()}d&&(d.node.off(s.EventType.CLICK),d.node.on(s.EventType.CLICK,(function(){console.log("[UIManager] Challenge button clicked for "+t.difficulty+" - "+t.levelIndex),f.emit(U.EventName.CHALLENGE_BUTTON_CLICKED,t.difficulty,t.levelIndex),l.closeAllPopups()}),this))},r.showRankingPopup=function(e,t){var n=this;this.showPopup(this.rankingPopupPrefab,(function(t){var o=t.getComponent(L);null==o||o.init(n),null==o||o.show(e)}))},r.populateRankItem=function(e,t,n){var o,i,a,r,l=this,s=null==(o=e.getChildByName("RankLabel"))?void 0:o.getComponent(u),p=null==(i=e.getChildByName("Avatar"))?void 0:i.getComponent(c),g=null==(a=e.getChildByName("NicknameLabel"))?void 0:a.getComponent(u),m=null==(r=e.getChildByName("ScoreLabel"))?void 0:r.getComponent(u);if(s&&(s.string=n?"我的排名: "+t.rank:""+t.rank),g&&(g.string=t.nickname||"匿名用户"),m&&(m.string="通关: "+t.score),p)if(t.avatarUrl)assetManager.loadRemote(t.avatarUrl,{ext:".png"},(function(e,t){if(!e&&b(p.node)){var n=y.createWithImage(t);p.spriteFrame=n}else{var o=l.getSpriteFrame(U.SpriteFrameName.DEFAULT_AVATAR);o&&(p.spriteFrame=o)}}));else{var d=this.getSpriteFrame(U.SpriteFrameName.DEFAULT_AVATAR);d&&(p.spriteFrame=d)}},r.showPopup=function(e,t){if(e)if(this.node){var n=C(e);if(n){this.node.addChild(n),this._activePopups.push(n),t&&t(n),n.setScale(.5,.5);var o=n.getComponent(h);o&&(o.opacity=0),v(n).to(.2,{scale:new I(1,1,1)},{easing:"backOut"}).start(),v(n.getComponent(h)||n.addComponent(h)).to(.2,{opacity:255}).start(),console.log("[UIManager] 显示弹窗: "+e.name)}else d("[UIManager] 实例化弹窗 Prefab 失败。")}else d("[UIManager] UIManager 节点无效，无法添加弹窗。");else d("[UIManager] 尝试显示一个空的弹窗 Prefab。")},r.closePopup=function(e){if(b(e)){var t=this._activePopups.indexOf(e);t>-1&&this._activePopups.splice(t,1),v(e).to(.15,{scale:new I(.5,.5,1)},{easing:"backIn"}).call((function(){b(e)&&(e.destroy(),console.log("[UIManager] 关闭弹窗: "+e.name))})).start(),v(e.getComponent(h)||e.addComponent(h)).to(.15,{opacity:0}).start()}},r.closeAllPopups=function(){var e=this;console.log("[UIManager] 关闭所有弹窗。"),[].concat(this._activePopups).forEach((function(t){return e.closePopup(t)})),this._activePopups=[]},r.showAdOverlay=function(){return this.adOverlayNode?(console.log("[UIManager] 显示广告遮罩层。"),this.adOverlayNode.active=!0,this.adContainerNode):(m("[UIManager] AdOverlayNode 未设置，无法显示广告层。"),null)},r.hideAdOverlay=function(){this.adOverlayNode&&(console.log("[UIManager] 隐藏广告遮罩层。"),this.adOverlayNode.active=!1)},r.onDestroy=function(){console.log("[UIManager] onDestroy"),f.targetOff(this),this.closeAllPopups()},t}(N)).prototype,"timerLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=t(oe.prototype,"pauseResumeButton",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=t(oe.prototype,"pauseResumeIcon",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=t(oe.prototype,"settingsButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=t(oe.prototype,"gameBoardNode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se=t(oe.prototype,"difficultySelectorNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=t(oe.prototype,"entryButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pe=t(oe.prototype,"easyButton",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(oe.prototype,"mediumButton",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=t(oe.prototype,"hardButton",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(oe.prototype,"masterButton",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=t(oe.prototype,"numberPadNode",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he=t(oe.prototype,"clearButton",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=t(oe.prototype,"undoButton",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ye=t(oe.prototype,"redoButton",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(oe.prototype,"settingsPopupPrefab",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(oe.prototype,"historyPopupPrefab",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=t(oe.prototype,"rankingPopupPrefab",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(oe.prototype,"recordItemPrefab",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=t(oe.prototype,"rankItemPrefab",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(oe.prototype,"adOverlayNode",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=t(oe.prototype,"adContainerNode",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(oe.prototype,"bottomNavBarNode",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(oe.prototype,"historyNavButton",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ee=t(oe.prototype,"rankingNavButton",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=oe))||ne));r._RF.pop()}}}));

System.register("chunks:///_virtual/UserData.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){e({createEmptyUserAccount:function(e){return{userId:e,levelRecords:{},totalLevelsCompleted:0}},generateLevelRecordKey:function(e,t){return e+"-"+t}}),t._RF.push({},"dfe6fGUs9hM/Z4t6eU0bBZI","UserData",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});